#! /usr/bin/env dbqn
"Usage: ./precompiled.bqn path/to/mlochbaum/BQN ""$PATH"" [expressions, else prim tests]"!2â‰¤â‰ â€¢args
pathâ†0âŠ‘â€¢args
envPâ†1âŠ‘â€¢args

tests â† â€¢FLines pathâˆ¾"/test/cases/prim.bqn"
# tests â† â€¢FLines pathâˆ¾"/test/cases/identity.bqn"
# tests â† â€¢FLines pathâˆ¾"/test/cases/undo.bqn"
# tests â† â€¢FLines pathâˆ¾"/test/cases/under.bqn"
# tests â† â€¢FLines pathâˆ¾"/test/cases/fill.bqn"
{testsâ†©ğ•©}âŸ(Ã—â‰ ) 2â†“â€¢args

('#'â‰  Â·âŠ‘ âˆ¾âŸœ"#")â—¶@â€¿{
  (âŠ‘'%'âŠ¸âˆŠ)â—¶{ğ•¤
    â€¢Out ğ•©
    "src/gen/interp" â€¢FChars âŸ¨1,path,ğ•©âŸ© â€¢Import "cc.bqn"
    # make â† "make"â€¿"singeli=1"â€¿"f=-DPRECOMP -march=native"â€¿"c"
    # make â† "make"â€¿"f=-DPRECOMP -m32"â€¿"lf=-m32"â€¿"c"
    make â† "make"â€¿"f=-DPRECOMP"â€¿"c"
    (Ã—âŠ‘)â—¶@â€¿{ğ•¤â‹„â€¢Out "############ Failed to compile! ############" â‹„ â€¢OutÂ¨1â†“ğ•©}{envâ‡<"PATH="âˆ¾envP}â€¢SH make
    codeâ€¿outâ€¿errâ†â€¢SHâŸ¨"./BQN"âŸ©
    â€¢Out out
    {ğ•¤â‹„â€¢Out"exit code "âˆ¾(â€¢Repr code) â‹„ â€¢Out err}âŸ(Ã—code) err
  }â€¿âŠ¢
}Â¨tests