u â† âŒŠ100Ã—(â€¢UnixTime+1|100Ã—â€¢MonoTime)@
r â† â€¢MakeRand â€¢Show u
âŸ¨RandVals, castsâŸ© â† âŸ¨râŸ© â€¢Import "utils.bqn"

# Test â€¢bit._cast first
# Convert unsigned width ğ•— to ğ•˜
_cvtu_ â† {
  ğ•—=ğ•˜ ? ğ•© ;
  ğ•—<ğ•˜ ? bâ†2â‹†ğ•— â‹„ +âŸœ(bâŠ¸Ã—)Ëâ‰âˆ˜â€¿(ğ•˜Ã·ğ•—)â¥Šğ•© ;
        bâ†2â‹†ğ•˜ â‹„ â¥Šâ‰>1(-âŠ¸â†“-bÃ—â†“)âŒŠâˆ˜Ã·âŸœbâŸ(â†•1+ğ•—Ã·ğ•˜)ğ•©
}
_bitcast â† { frâ€¿to _ğ•£ ğ•©:
  S â† {ğ•Š:ğ•©+ğ•¨Ã—ğ•©<0; ğ•Šâ¼:ğ•©-ğ•¨Ã—ğ•©â‰¥ğ•¨Ã·2}
  _off â† {(âŠ‘"uci"âŠ1âŠ‘ğ•—)âŠ‘âŸ¨âŠ¢,-âŸœ@,(2â‹†âŠ‘ğ•—)âŠ¸SâŸ©}
  fâ€¿t â† âŠ‘Â¨ğ•—
  to _offâ¼  f _cvtu_ t  fr _off  ğ•©
}

TestCast â† { fâ€¿t ğ•Š len:
  c â† ğ•¨ âŠ casts
  len +â†© (1âŒˆÃ·ËœÂ´âŠ‘Â¨c) | -len  # Round up to exact conversion
  (c _bitcast â‰¡ c â€¢bit._cast) len RandVals f
}
cs â† / 64>âŠ‘Â¨casts             # TODO floats
cx â† âŠâŸœ(32â€¿'c'âŠ¸â‰¢Â¨casts)âŠ¸/ cs  # TODO 32-bit char output
ls â† (â†•100) âˆ¾ r.RangeÂ¨âŠ¸+ âŒŠ 100 Ã— â†•âˆ˜âŒˆâŒ¾(1.5âŠ¸â‹†â¼) 100
{cs (â‹ˆ !âˆ˜TestCast ğ•©Ë™)âŒœ cx}Â¨ ls
