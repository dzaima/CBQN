# not tested here: â€¢Out â€¢Show â€¢Exit â€¢GetLine â€¢Cmp â€¢CurrentError â€¢FFI â€¢internal.HeapDump â€¢file.MapBytes

%DEF var Vâ†â€¢internal.Variation â‹„ LVâ†â€¢internal.ListVariations â‹„ CLRâ†â€¢internal.ClearRefs
%DEF tvar %USE var â‹„ _tvar â† {F _ğ•£ x: (CLR@) âŠ¢ {F ğ•© V x}Â¨ LV ğ•©; w F _ğ•£ x: (CLR@) âŠ¢ (LV ğ•¨) {(ğ•¨ V w) F ğ•© V x}âŒœ LV ğ•©}

# standard system values

# â€¢BQN
%USE tvar â‹„ !âˆ˜â‰¡âŸœ" "Â¨ â€¢BQN _tvar "1â†‘"""""
âŸ¨âŸ© â€¢BQN "Ah"â€¢internal.Variation"1â†‘""""" %% " "
! â‰¡Â´ tâ†âŸ¨â€¢path,"custom-name", "arg"âŸ©â€¢BQN"âŸ¨â€¢pathâ€¿â€¢nameâ€¿â€¢args â‹„ â€¢stateâŸ©" â‹„ ! âŸ¨â€¢path, "custom-name", "arg"âŸ© â‰¡ âŠ‘t
! â‰¡Â´ tâ†âŸ¨â€¢path,"custom-name"       âŸ©â€¢BQN"âŸ¨â€¢pathâ€¿â€¢nameâ€¿â€¢args â‹„ â€¢stateâŸ©" â‹„ ! âŸ¨â€¢path, "custom-name", âŸ¨âŸ©âŸ©    â‰¡ âŠ‘t
! â‰¡Â´ tâ†âŸ¨â€¢path                     âŸ©â€¢BQN"âŸ¨â€¢pathâ€¿â€¢nameâ€¿â€¢args â‹„ â€¢stateâŸ©" â‹„ ! âŸ¨â€¢path, "",            âŸ¨âŸ©âŸ©    â‰¡ âŠ‘t
! â‰¡Â´ tâ†âŸ¨                          âŸ©â€¢BQN"âŸ¨â€¢pathâ€¿â€¢nameâ€¿â€¢args â‹„ â€¢stateâŸ©" â‹„ !        âŸ¨"",            âŸ¨âŸ©âŸ©    â‰¡ 1â†“âŠ‘t
!"â€¢BQN: Path must be a string" % âŸ¨1â€¿2âŸ© â€¢BQN "2+2"
!"â€¢BQN: Filename must be a string" % âŸ¨â€¢path, 1â€¿2âŸ© â€¢BQN "2+2"
âŸ¨â€¢path, "abc/def"âŸ© â€¢BQN "â€¢name" %% "abc/def"
!"Failed to resolve ""path that doesn't exist"": No such file or directory" % âŸ¨"path that doesn't exist"âŸ©â€¢BQN"â€¢path"
!"Failed to resolve ""path that doesn't exist"": No such file or directory" % âŸ¨"path that doesn't exist"âŸ©â€¢BQN"â€¢state"
âŸ¨"path that doesn't exist"âŸ©â€¢BQN"2+2" %% 4

# â€¢ReBQN
!"REPL: Filename must be a string" % fâ†â€¢ReBQN{â‡} â‹„ âŸ¨â€¢path, 1â€¿2âŸ© F "2+2"
!"REPL: Path must be a string" % fâ†â€¢ReBQN{â‡} â‹„ âŸ¨1â€¿2âŸ© F "2+2"
fâ†â€¢ReBQN{â‡} â‹„ ! âŸ¨â€¢path, "custom-name", "arg"âŸ© â‰¡ âŸ¨â€¢path,"custom-name", "arg"âŸ© F "â€¢state"

fâ†â€¢ReBQN {systemâ‡"all"} â‹„ F "â€¢internal.Type â†•10" %% "i8arr"
!"Unknown system function â€¢internal" % fâ†â€¢ReBQN {systemâ‡"none"} â‹„ F "â€¢internal.Type â†•10"
fâ†â€¢ReBQN {systemâ‡âŸ¨"range"â€¿â†• â‹„ "add"â€¿+ â‹„ "reverse"â€¿âŒ½âŸ©} â‹„ F "â€¢Reverse Â¯5 â€¢Add â€¢Range 10" %% 4-â†•10

fâ†â€¢ReBQN{â‡} â‹„ F "Ah"â€¢internal.Variation"1â†‘""""" %% " "

Fâ†(â€¢ReBQN{replâ‡"none"  })âŠ({ğ•©â†‘ËœâŠ‘ğ•©âŠ@+10}â€¢CurrentError) â‹„ âŸ¨F"aâ†â†•2", F"aâ†â†•3", F"a"âŸ© %% âŸ¨0â€¿1,0â€¿1â€¿2,"Undefined identifier"âŸ©
Fâ†(â€¢ReBQN{replâ‡"loose" })âŠ({ğ•©â†‘ËœâŠ‘ğ•©âŠ@+10}â€¢CurrentError) â‹„ âŸ¨F"aâ†â†•2", F"aâ†â†•3", F"a"âŸ© %% âŸ¨0â€¿1,0â€¿1â€¿2,0â€¿1â€¿2âŸ©
Fâ†(â€¢ReBQN{replâ‡"strict"})âŠ({ğ•©â†‘ËœâŠ‘ğ•©âŠ@+10}â€¢CurrentError) â‹„ âŸ¨F"aâ†â†•2", F"aâ†â†•3", F"a"âŸ© %% âŸ¨0â€¿1,"Redefinition",0â€¿1âŸ©

f â† â€¢ReBQN{replâ‡"none"} â‹„ !6â‰¡â€¢Type F "aâ‡1"
f â† â€¢ReBQN{replâ‡"none"} â‹„ !6â‰¡â€¢Type F "â‡"
!"Cannot construct a namespace for a REPL result" % f â† â€¢ReBQN{replâ‡"loose"} â‹„ F "aâ‡1"
!"Cannot construct a namespace for a REPL result" % f â† â€¢ReBQN{replâ‡"loose"} â‹„ F "â‡"
!"Cannot construct a namespace for a REPL result" % f â† â€¢ReBQN{replâ‡"strict"} â‹„ F "aâ‡1"
!"Cannot construct a namespace for a REPL result" % f â† â€¢ReBQN{replâ‡"strict"} â‹„ F "â‡"

fâ†â€¢ReBQN {primitivesâ‡â‹ˆ'Ã·'â€¿-} â‹„ ! Â¯5 â‰¡ F"â€¢BQN""Ã·5""" â‹„ bâ†F"â€¢BQN" â‹„ ! Â¯5 â‰¡ B "Ã·5" â‹„ ! 0.2 â‰¡ â€¢BQN "Ã·5"
fâ†â€¢ReBQN {primitivesâ‡â‹ˆ'Ã·'â€¿-} â‹„ a1 â† â€¢bqn â‹„ r1 â† F"â€¢BQN" â‹„ a2 â† A1"â€¢BQN" â‹„ r2 â† R1"â€¢BQN" â‹„ a3 â† A1"â€¢ReBQN{â‡}" â‹„ r3 â† R1"â€¢ReBQN{â‡}" â‹„ {ğ•"Ã·"}Â¨ âŸ¨a1,r1,a2,r2,a3,r3âŸ© %% âŸ¨Ã·,-,Ã·,-,Ã·,-âŸ©
fâ†â€¢ReBQN {replâ‡"none"  â‹„ primitivesâ‡â‹ˆ'Ã·'â€¿Ã·} â‹„ ! "Unknown character: '-'" â‰¡ FâŠ{ğ•Š: â€¢CurrentError@} "-5" â‹„ ! 0.2 â‰¡ â€¢BQN "Ã·5"
fâ†â€¢ReBQN {replâ‡"loose" â‹„ primitivesâ‡â‹ˆ'Ã·'â€¿Ã·} â‹„ ! "Unknown character: '-'" â‰¡ FâŠ{ğ•Š: â€¢CurrentError@} "-5" â‹„ ! 0.2 â‰¡ â€¢BQN "Ã·5"
ps â† âŸ¨'Ã·'â€¿Ã·âŸ© â‹„ fâ†â€¢ReBQN {replâ‡"none"  â‹„ primitivesâ‡ps} â‹„ ! ps â‰¡ F "â€¢primitives" â‹„ ! â€¢primitives â‰¡ â€¢BQN "â€¢primitives" â‹„ ! ps â‰¡ F "â€¢primitives"
ps â† âŸ¨'Ã·'â€¿Ã·âŸ© â‹„ fâ†â€¢ReBQN {replâ‡"loose" â‹„ primitivesâ‡ps} â‹„ ! ps â‰¡ F "â€¢primitives" â‹„ ! â€¢primitives â‰¡ â€¢BQN "â€¢primitives" â‹„ ! ps â‰¡ F "â€¢primitives"

fâ†â€¢ReBQN{primitivesâ‡â‹ˆ'Ã·'â€¿- â‹„ systemâ‡âŸ¨"foo"â€¿â‹ˆ, "oldbqn"â€¿â€¢BQN, "bqn"âŸ©} â‹„ {ğ• "Ã·5"}Â¨ F "âŸ¨â€¢foo, â€¢OldBQN, â€¢BQNâŸ©" %% âŸ¨â‹ˆ"Ã·5", 0.2, Â¯5âŸ©
!"â€¢ReBQN: No system value ""baz"" to inherit" % â€¢ReBQN{systemâ‡âŸ¨"foo"â€¿"bar", "bqn", "baz", "rebqn"âŸ©}
!"â€¢ReBQN: No system value ""bqn"" to inherit" % fâ†â€¢ReBQN{systemâ‡âŸ¨"baz"â€¿1, "rebqn", "foo"â€¿2âŸ©} â‹„ gâ†F"â€¢ReBQN" â‹„ G {systemâ‡âŸ¨"foo"â€¿"bar", "baz", "bqn", "rebqn"âŸ©}
fâ†â€¢ReBQN{primitivesâ‡â‹ˆ'Ã·'â€¿- â‹„ systemâ‡âŸ¨"primitives", "foo"â€¿â‹ˆ, "bqn", "listsys"âŸ©} â‹„ F"â€¢primitivesâ€¿â€¢listsys" %% âŸ¨âŸ¨'Ã·'â€¿-âŸ© â‹„ âŸ¨"primitives","foo","bqn","listsys"âŸ©âŸ©


# â€¢primitives
!âˆ§Â´2=â€¢TypeÂ¨ âŠ‘Â¨â€¢primitives
!Â¨ (â€¢TypeÂ¨1âŠ‘Â¨â€¢primitives)âˆŠ3â€¿4â€¿5

# â€¢state
6âŠ¸â†‘âŒ¾(1âŠ¸âŠ‘) â€¢file.NameâŒ¾âŠ‘ â€¢state %% âŸ¨"testDir","system",âŸ¨"arg0",1âŸ©âŸ©

# â€¢args
â€¢args %% âŸ¨"arg0",1âŸ©

# â€¢path & â€¢file.path
â€¢file.Name â€¢path %% "testDir"
â€¢file.Name â€¢file.path %% "testDir"

# â€¢name
6â†‘â€¢name %% "system"

# â€¢wdpath
! âˆ§Â´ 2=â€¢TypeÂ¨ â€¢wdpath

# â€¢ns
{abcâ‡1 â‹„ dÃŠFâ‡2}â€¢ns.GetÂ¨ âŸ¨"abc", "ABC", "abC", "abc___", "DÃªF", "__D__ÃŠ__F__"âŸ© %% 1â€¿1â€¿1â€¿1â€¿2â€¿2
!"Field named ""abcdefghijklmnopqrstuvwxyzÃ Ã¡Ã¢Ã£Ã¤Ã¥Ã¦Ã§Ã¨Ã©ÃªÃ«Ã¬Ã­Ã®Ã¯Ã°Ã±Ã²Ã³Ã´ÃµÃ¶Ã¸Ã¹ÃºÃ»Ã¼Ã½Ã¾abcdefghijklmnopqrstuvwxyzÃ Ã¡Ã¢Ã£Ã¤Ã¥Ã¦Ã§Ã¨Ã©ÃªÃ«Ã¬Ã­Ã®Ã¯Ã°Ã±Ã²Ã³Ã´ÃµÃ¶Ã¸Ã¹ÃºÃ»Ã¼Ã½Ã¾ğ•¨ğ•¨â‰!0123456789"" not found" % {abcâ‡1 â‹„ dÃŠFâ‡2}âŠ¸â€¢ns.Get "ABCDEFGHIJKLMNOPQRSTUVWXYZÃ€ÃÃ‚ÃƒÃ„Ã…Ã†Ã‡ÃˆÃ‰ÃŠÃ‹ÃŒÃÃÃÃÃ‘Ã’Ã“Ã”Ã•Ã–Ã˜Ã™ÃšÃ›ÃœÃÃabcdefghijklmnopqrstuvwxyzÃ Ã¡Ã¢Ã£Ã¤Ã¥Ã¦Ã§Ã¨Ã©ÃªÃ«Ã¬Ã­Ã®Ã¯Ã°Ã±Ã²Ã³Ã´ÃµÃ¶Ã¸Ã¹ÃºÃ»Ã¼Ã½Ã¾ğ•¨ğ•¨â‰!0123456789_"
{abcâ‡1 â‹„ dÃŠFâ‡2 â‹„ n10â‡3}â€¢ns.HasÂ¨ âŸ¨"abc", "ABC", "abC", "abc___", "DÃªF", "__D__ÃŠ__F__", "Ã bc", "def", "", â†•0, "ğ•¨", "012", "n10", "n1_0"âŸ© %% 1â€¿1â€¿1â€¿1â€¿1â€¿1â€¿0â€¿0â€¿0â€¿0â€¿0â€¿0â€¿1â€¿1
âˆ¨Â´{â‡}â€¢ns.HasÂ¨â†‘"abc123AEWQE___Ã Ã€ğ•¨ğ•©" %% 0
!"â€¢ns.Has: ğ•© must be a string" % {â‡}â€¢ns.Has â‰""
!"â€¢ns.Has: ğ•© must be a string" % {â‡}â€¢ns.Has 1â€¿2
!"â€¢ns.Get: ğ•© must be a string" % {â‡}â€¢ns.Get â‰""
!"â€¢ns.Get: ğ•© must be a string" % {â‡}â€¢ns.Get 1â€¿2
{mâ†ğ•© â‹„ âŸ¨{ğ•© â‹ˆ mâ€¢ns.Get ğ•©}Â¨ â€¢ns.Keys m â‹„ {mâ€¢ns.Hasâ‹ˆğ•©}Â¨ "abcABC"âŸ©}Â¨ âŸ¨{aâ‡1â‹„bâ‡â†•10} â‹„ {aâ‡'a'â‹„bâ†2â€¿3â‹„cdeâ‡ğ•©}"abc"âŸ© %% âŸ¨âŸ¨âŸ¨âŸ¨"a",1âŸ©,âŸ¨"b",0â€¿1â€¿2â€¿3â€¿4â€¿5â€¿6â€¿7â€¿8â€¿9âŸ©âŸ©,1â€¿1â€¿0â€¿1â€¿1â€¿0âŸ©,âŸ¨âŸ¨âŸ¨"a",'a'âŸ©,âŸ¨"cde","abc"âŸ©âŸ©,1â€¿0â€¿0â€¿1â€¿0â€¿0âŸ©âŸ©



# files; tests are ordered!
{â€¢file.Exists ğ•©? âŠ‘â€¢SHâŸ¨"rmdir", â€¢file.At ğ•©âŸ©; 0} "testdirNested" %% 0
â€¢file.RemoveâŸâ€¢file.ExistsÂ¨ "testfile.bqn"â€¿"testfile2.bqn"â€¿"testfile3B.bqn"â€¿"badwrite" â‹„ 1 %% 1
â€¢file.At "/a/b" %% "/a/b"
! (â€¢file.At "a/b") â‰¡ â€¢file.path â€¢file.At "a/b"
"a/b" â€¢file.At "c/d" %% "a/b/c/d"
"a/b/" â€¢file.At "c/d" %% "a/b/c/d"
"a/b/" â€¢file.At "c/d/" %% "a/b/c/d/"
"a/b/" â€¢file.At "/c/d" %% "/c/d"
"a/b" â€¢file.At "/c/d/" %% "/c/d/"
â€¢file.Exists "/dev/file that doesn't exist" %% 0
!"Couldn't read file ""/dev/file that doesn't exist""" % â€¢FChars "/dev/file that doesn't exist"
! (â€¢pathâˆ¾"/") â‰¡ â€¢file.Parent â€¢file.At "hi"
!"â€¢file.Parent: Path must be non-empty" % â€¢file.Parent ""
!"â€¢file.Name: Path must be non-empty" % â€¢file.Name ""

!"â€¢file.Lines: ğ•© must be a list" % "testfile.bqn" â€¢FLines 2â€¿2â¥Š<"abcd"
!"â€¢file.Lines: ğ•© must be a list" % "testfile.bqn" â€¢file.Lines <"abcd"
!"â€¢file.Lines: Elements of ğ•© must be lists of characters" % "testfile.bqn" â€¢FLines "abcd"
!"Expected character" % "testfile.bqn" â€¢FLines â‹ˆ"ab"â€¿"cd"
!"Expected character" % "testfile.bqn" â€¢FLines â‹ˆ1â€¿2
!"Expected character" % "testfile.bqn" â€¢FChars â‹ˆ"abcd"
!"â€¢file.Chars: ğ•© must be a list of characters" % "testfile.bqn" â€¢FChars <'a'
!"Expected character" % "testfile.bqn" â€¢FBytes â‹ˆ"abcd"
!"â€¢file.Bytes: ğ•© must be a list" % "testfile.bqn" â€¢file.Bytes <'a'
!"Expected character" % "badwrite"â€¢FChars ""â€¿""
!"Expected character" % "badwrite"â€¢FLines âŸ¨âŸ¨"foo"âŸ©âŸ©
!"â€¢file.Chars: ğ•© must be a list of characters" % "badwrite"â€¢FChars @

! {ğ•©â‰¡â€¢file.Name ğ•© â€¢FChars         "abc"âˆ¾(@+10)âˆ¾"defğ•©"}"testfile.bqn"
! {ğ•©â‰¡â€¢file.Name ğ•© â€¢FBytes â€¢ToUTF8 "abc"âˆ¾(@+10)âˆ¾"defğ•©"}"testfile2.bqn"
! {ğ•©â‰¡â€¢file.Name ğ•© â€¢FLines         "abc"â€¿"defğ•©"}       "testfile3.bqn"
â€¢file.Type "testfile.bqn" %% 'f'
â€¢file.Type â€¢file.path %% 'd'
!Â¨ 0â‰¤{ğ• "testfile.bqn"}Â¨ â€¢file.Createdâ€¿â€¢file.Accessedâ€¿â€¢file.Modified
â€¢file.Size "testfile.bqn" %% 11

â€¢FBytesÂ¨ "testfile.bqn"â€¿"testfile2.bqn"â€¿"testfile3.bqn"
â€¢FChars "testfile.bqn" %% "abc"âˆ¾(@+10)âˆ¾"defğ•©"
â€¢FBytes "testfile.bqn" %% @+97â€¿98â€¿99â€¿10â€¿100â€¿101â€¿102â€¿240â€¿157â€¿149â€¿169
â€¢FLines "testfile.bqn" %% "abc"â€¿"defğ•©"

"testfile3B.bqn" â€¢file.Rename "testfile3.bqn"
!"â€¢file.Rename: Failed to rename file" % "testfile3B.bqn" â€¢file.Rename "testfile.bqn"
â€¢file.ExistsÂ¨ "testfile.bqn"â€¿"nontestfile.bqn"â€¿"testfile3.bqn"â€¿"testfile3B.bqn" %% 1â€¿0â€¿0â€¿1
Â¯22â†‘â€¢file.Createdir "testdirNested" %% "/testDir/testdirNested"
Â¯8â†‘â€¢file.RealPath "testdirNested/.././" %% "/testDir"
!"â€¢file.CreateDir: Failed to create directory" % â€¢file.Createdir "testdirNested"
"testfile.bqn"â€¿"testfile2.bqn"â€¿"testfile3.bqn"â€¿"testfile3B.bqn"â€¿"testdirNested" âˆŠ â€¢file.List "." %% 1â€¿1â€¿0â€¿1â€¿1
"testfile.bqn"â€¿"testfile2.bqn"â€¿"testfile3.bqn"â€¿"testfile3B.bqn"â€¿"testdirNested" âˆŠ â€¢file.List â€¢file.path %% 1â€¿1â€¿0â€¿1â€¿1

â€¢file.Remove "testfile.bqn" %% 1
â€¢file.Remove "testfile2.bqn" %% 1
â€¢file.Remove "testfile3B.bqn" %% 1
"testfile.bqn"â€¿"testfile2.bqn"â€¿"testfile3B.bqn"â€¿"badwrite" âˆŠ â€¢file.List "." %% 0â€¿0â€¿0â€¿0

!"Failed to resolve ""/dev/file that doesn't exist"": No such file or directory" % â€¢file.RealPath "/dev/file that doesn't exist"
!"Failed to resolve ""/dev/file that doesn't exist"": No such file or directory" % â€¢Import "/dev/file that doesn't exist"

# bad paths
!"â€¢file.At: Path must be a list of characters" % â€¢file.At 1â€¿2
!"â€¢file.At: Path must be a list of characters" % â€¢file.At 1â€¿2
!"â€¢file.At: Path must be a list of characters" % "foo" â€¢file.At 1â€¿2
!"â€¢file.At: ğ•¨ must be a string" % 1â€¿2 â€¢file.At "foo"
!"â€¢file.List: Path must be a list of characters" % â€¢file.List 1â€¿2
!"â€¢file.Bytes: Path must be a list of characters" % â€¢file.Bytes 1â€¿2
!"â€¢file.Chars: Path must be a list of characters" % â€¢file.Chars 1â€¿2
!"â€¢file.Lines: Path must be a list of characters" % â€¢file.Lines 1â€¿2
!"â€¢file.Bytes: Path must be a list of characters" % 1â€¿2 â€¢FBytes "abc"
!"â€¢file.Chars: Path must be a list of characters" % 1â€¿2 â€¢FChars "abc"
!"â€¢file.Lines: Path must be a list of characters" % 1â€¿2 â€¢FLines "abc"â€¿"def"
!"â€¢file.Type: Path must be a list of characters" % â€¢file.Type 1â€¿2
!"â€¢file.Exists: Path must be a list of characters" % â€¢file.Exists 1â€¿2
!"â€¢file.Name: Argument must be a string" % â€¢file.Name 1â€¿2
!"â€¢file.Parent: Argument must be a string" % â€¢file.Parent 1â€¿2
!"â€¢file.MapBytes: Path must be a list of characters" % â€¢file.MapBytes 1â€¿2
!"â€¢file.CreateDir: Path must be a list of characters" % â€¢file.CreateDir 1â€¿2
!"â€¢file.RealPath: Path must be a list of characters" % â€¢file.RealPath 1â€¿2
!"â€¢file.Rename: Path must be a list of characters" % "foo" â€¢file.Rename 1â€¿2
!"â€¢file.Rename: Path must be a list of characters" % 1â€¿2 â€¢file.Rename "foo"
!"â€¢file.Remove: Path must be a list of characters" % â€¢file.Remove 1â€¿2
!"â€¢file.Created: Path must be a list of characters" % â€¢file.Created 1â€¿2
!"â€¢file.Modified: Path must be a list of characters" % â€¢file.Modified 1â€¿2
!"â€¢file.Accessed: Path must be a list of characters" % â€¢file.Accessed 1â€¿2
!"â€¢file.Size: Path must be a list of characters" % â€¢file.Size 1â€¿2
!"â€¢file.Size: Path must be a list of characters" % â€¢file.Size 2â€¿2â¥Š"abcd"



# some of â€¢term
!"Expected character" % â€¢term.OutRaw 2â¥Š{â‡}
!"â€¢term.ErrRaw: ğ•© must be a list" % â€¢term.ErrRaw 2â€¿2â¥Š0



# â€¢ParseFloat & â€¢Repr
vâ†1 â‹„ ! â€¢BQNâˆ˜â€¢ReprâŠ¸â‰¡ âŸ¨+,1â€¿2,+Â¨,(+V)(V+V),2â€¿2â¥Šâ†•4âŸ©
# vâ†1 â‹„ â€¢BQNâˆ˜â€¢ReprâŠ¸â‰¡ âŸ¨V V V, V VâŸ© # TODO enable
64â€¿1â€¢bit._cast â€¢ParseFloatÂ¨ "123.456000000000000"â€¿"123.45600000000002" %% "11101110011111011111100101011000111101001011101101111010000000100001111001111101111110010101100011110100101110110111101000000010"-'0'
! âˆ§Â´'e'=â€¢ParseFloatâŠ'e'Â¨ "-"â€¿"e2"â€¿"-e2"â€¿"."â€¿".e2"â€¿"123e"â€¿"123e-"â€¿"123e+"
â€¢ParseFloat "0."âˆ¾(nâ¥Š'0')âˆ¾"1234e"âˆ¾â€¢Repr nâ†1000000 %% 0.1234
â€¢Reprâˆ˜â€¢ParseFloatÂ¨ âŸ¨"1.23516411460311636e-323", "1.23516411460311637e-323"âŸ© %% âŸ¨"1eÂ¯323","1.5eÂ¯323"âŸ©
â€¢Reprâˆ˜â€¢ParseFloatÂ¨ âŸ¨"1.235164114603116360e-323", "1.235164114603116361e-323"âŸ© %% âŸ¨"1eÂ¯323","1eÂ¯323"âŸ©
â€¢Reprâˆ˜â€¢ParseFloatÂ¨ âŸ¨"1.2351641146031163604e-323", "1.2351641146031163605e-323"âŸ© %% âŸ¨"1eÂ¯323","1eÂ¯323"âŸ©

# â€¢Fmt
â€¢Fmt 123 %% "123"

# â€¢SH
â€¢SHâŸ¨"true"âŸ© %% 0â€¿âŸ¨âŸ©â€¿âŸ¨âŸ©
â€¢SHâŸ¨"false"âŸ© %% 1â€¿âŸ¨âŸ©â€¿âŸ¨âŸ©
{stdinâ‡"ğ•©"âˆ¾@+â†•256} â€¢SHâŸ¨"cat"âŸ© %% âŸ¨0, "ğ•©"âˆ¾@+â†•256, ""âŸ©
{stdinâ‡"ğ•©"âˆ¾@+â†•256 â‹„ rawâ‡0} â€¢SHâŸ¨"cat"âŸ© %% âŸ¨0, "ğ•©"âˆ¾@+â†•256, ""âŸ©
{stdinâ‡@+â†•256 â‹„ rawâ‡1} â€¢SHâŸ¨"cat"âŸ© %% âŸ¨0, @+â†•256, ""âŸ©

# â€¢Type
â€¢TypeÂ¨ âŸ¨"ab",'a'â€¿1,1,0Ã·0,'a',@+1114111,+,{ğ•©},Â¨,{ğ•—},âˆ˜,{ğ”½ğ•˜},{â‡},â€¢randâŸ© %% 0â€¿0â€¿1â€¿1â€¿2â€¿2â€¿3â€¿3â€¿4â€¿4â€¿5â€¿5â€¿6â€¿6

# â€¢Glyph
â€¢GlyphÂ¨ âŸ¨+,Â¨,âˆ˜âŸ© %% "+Â¨âˆ˜"

# â€¢Decompose
{!  0â€¿ğ•© â‰¡ â€¢Decompose ğ•©}Â¨ âŸ¨+, Â¨, ËâŸ©
{!  1â€¿ğ•© â‰¡ â€¢Decompose ğ•©}Â¨ âŸ¨{ğ•©}, {ğ”½ğ•˜}âŸ©
{! Â¯1â€¿ğ•© â‰¡ â€¢Decompose ğ•©}Â¨ âŸ¨1,'a',"ab"âŸ©
â€¢DecomposeÂ¨ âŸ¨+-Ã—, -Ã·, +Â¨, 1âˆ˜+âŸ© %% âŸ¨âŸ¨3,+,-,Ã—âŸ©,âŸ¨2,-,Ã·âŸ©,âŸ¨4,+,Â¨âŸ©,âŸ¨5,1,âˆ˜,+âŸ©âŸ©

# â€¢UnixTime
â€¢Type â€¢UnixTime â†•10 %% 1

# â€¢MonoTime
! â‰¤Â´â€¢MonoTimeÂ¨â†•2

# â€¢Delay
t0â†â€¢MonoTime@ â‹„ ! 0.1â‰¤â€¢Delay 0.1 â‹„ ! 0.1â‰¤(â€¢MonoTime@)-t0

# â€¢_timed tested at perf.bqn

# â€¢math
! âˆ§Â´0=âŒŠ|1e10Ã—{(+Â´ğ•©)-â€¢math.Sum ğ•©}Â¨ â†‘1000â€¢rand.Range 0
!"â€¢math.Sum: Argument must be a list (âŸ¨âŸ© â‰¡ â‰¢ğ•©)" % â€¢math.Sum 2
!"â€¢math.Sum: Argument must be a list (2â€¿2 â‰¡ â‰¢ğ•©)" % â€¢math.Sum 2â€¿2â¥Š1
!"â€¢math.Sum: Argument elements must be numbers" % â€¢math.Sum 1â€¿'a'



# two assumptions made by the following tests
%DEF nan nanâ†âŠ‘1â€¿64â€¢bit._cast/51â€¿13 â‹„ nans â† nanâˆ¾-nan
%USE nan â‹„ 64â€¿32â€¢bit._cast nans %% 0â€¿Â¯524288â€¿0â€¿2146959360
%USE nan â‹„ 64â€¿32â€¢bit._cast (Â¯1âŠ¸Ã—â‰âŠ¢) (â†•3)âˆ¾âˆâˆ¾nan %% 2â€¿10â¥Š0â€¿Â¯2147483648â€¿0â€¿Â¯1074790400â€¿0â€¿Â¯1073741824â€¿0â€¿Â¯1048576â€¿0â€¿Â¯524288â€¿0â€¿0â€¿0â€¿1072693248â€¿0â€¿1073741824â€¿0â€¿2146435072â€¿0â€¿Â¯524288
64â€¿32â€¢bit._cast âŸ¨Ï€, 0, â€¢ParseFloat"-0"âŸ© %% 1413754136â€¿1074340347â€¿0â€¿0â€¿0â€¿Â¯2147483648

! {(ğ•© â€¢math.Atan2 0) â‰¡ ğ•© â€¢math.Atan2 â€¢ParseFloat"-0"} (-â‰âŠ¢) âˆâˆ¾Ëœâ†•3
! {(0 â€¢math.Atan2 ğ•©) â‰¡ (â€¢ParseFloat"-0") â€¢math.Atan2 ğ•©} (-â‰âŠ¢) âˆâˆ¾Ëœâ†•3
Eâ†â€¢internal.EEqual â‹„ aâ†(Â¯1âŠ¸Ã—â‰âŠ¢) (â†•3)âˆ¾âˆâˆ¾0Ã·0 â‹„ {ğ•©!(a ğ• 0)E a ğ• â€¢ParseFloat"-0" â‹„ ğ•©!(0 ğ• a)E(â€¢ParseFloat"-0") ğ• a}Â¨ (âŠ¢âˆ¾{ğ•Â¨}Â¨) âŸ¨+,-,Ã—,Ã·,â‹†,âˆš,âŒŠ,âŒˆ,|,Â¬,âˆ§,âˆ¨,<,>,â‰ ,=,â‰¤,â‰¥, â€¢math.Atan2,â€¢math.Comb,â€¢math.HypotâŸ©
Eâ†â€¢internal.EEqual â‹„ {! (ğ• 4â¥Š0) E ğ• 1â†“Â¯1Ã—Ï€âˆ¾4â¥Š0}Â¨ (âŠ¢âˆ¾{ğ•Â¨}Â¨) âŸ¨+,-,Ã—,Ã·,â‹†,âˆš,âŒŠ,âŒˆ,|,Â¬, â€¢math.Sin,â€¢math.Cos,â€¢math.Tan,â€¢math.Asin,â€¢math.Acos,â€¢math.Atan,â€¢math.Sinh,â€¢math.Cosh,â€¢math.Tanh,â€¢math.Asinh,â€¢math.Acosh,â€¢math.Atanh,â€¢math.Cbrt,â€¢math.Log2,â€¢math.Log10,â€¢math.Log1p,â€¢math.Expm1,â€¢math.Fact,â€¢math.LogFact,â€¢math.Erf,â€¢math.ErfCâŸ©
â€¢internal.EEqualÂ´Â¨ 1âŠË˜Â¨{âŸ¨â€¢math.Atan2âŸœ2â¼ğ•©, â€¢math.Atan2âŸœ0â¼ğ•©, 2âŠ¸â€¢math.Atan2â¼ğ•©, 0âŠ¸â€¢math.Atan2â¼ğ•©âŸ©} (Â¯1âŠ¸Ã—â‰âŠ¢) 1.2â€¿0 %% 1â€¿1â€¿1â€¿1

{15 ğ• 10}Â¨ âŸ¨â€¢math.GCD,â€¢math.LCMâŸ© %% 5â€¿30
âŒŠ1e5Ã—{0.1 ğ• 0.2}Â¨ âŸ¨â€¢math.Atan2,â€¢math.Comb,â€¢math.Hypot,â€¢math.Atan2â¼,â€¢math.Atan2Ëœâ¼âŸ© %% 110714â€¿96959â€¿22360â€¿2027â€¿49331
âŒŠ1e5Ã—{=Ëœâ—¶99â€¿âŠ¢Â¨ ğ• 0.1â€¿3}Â¨ âŸ¨â€¢math.Acos,â€¢math.Acosh,â€¢math.Asin,â€¢math.Asinh,â€¢math.Atan,â€¢math.Atanh,â€¢math.Cbrt,â€¢math.Cos,â€¢math.Cosh,â€¢math.Erf,â€¢math.ErfC,â€¢math.Expm1,â€¢math.Fact,â€¢math.Log10,â€¢math.Log1p,â€¢math.Log2,â€¢math.LogFact,â€¢math.Sin,â€¢math.Sinh,â€¢math.Tan,â€¢math.TanhâŸ© %% âŸ¨147062â€¿9900000,9900000â€¿176274,10016â€¿9900000,9983â€¿181844,9966â€¿124904,10033â€¿9900000,46415â€¿144224,99500â€¿Â¯99000,100500â€¿1006766,11246â€¿99997,88753â€¿2,10517â€¿1908553,95135â€¿600000,Â¯100000â€¿47712,9531â€¿138629,Â¯332193â€¿158496,Â¯4988â€¿179175,9983â€¿14112,10016â€¿1001787,10033â€¿Â¯14255,9966â€¿99505âŸ©
!"â€¢math.GCD: Inputs other than natural numbers not yet supported" % 1.5 â€¢math.GCD 3
!"â€¢math.LCM: Inputs other than natural numbers not yet supported" % 3 â€¢math.LCM 1.5
!"â€¢math.GCD: Unexpected argument types" % "foo" â€¢math.LCM 3
!"â€¢math.GCD: Unexpected argument types" % 3 â€¢math.GCD {+}
!"â€¢math.Sin: Argument contained non-number" % â€¢math.Sin "foo"
!"â€¢math.Log10: Argument contained non-number" % â€¢math.Log10 "foo"
!"â€¢math.Atan2: Unexpected argument types" % 1 â€¢math.Atan2 'a'
!"â€¢math.Atan2â¼: Unexpected argument types" % 1 â€¢math.Atan2â¼ {â‡}
!"â€¢math.Atan2Ëœâ¼: Unexpected argument types" % {â‡} â€¢math.Atan2Ëœâ¼ 'b'

# â€¢rand / â€¢MakeRand
0 (â€¢MakeRand 0).RangeÂ¨â†•2 %% âŸ¨âŸ©â€¿âŸ¨âŸ©
0â€¿0 (â€¢MakeRand 0).RangeÂ¨â†•2 %% âŸ¨âŸ©â€¿âŸ¨âŸ©
(â€¢MakeRand 0).Deal 0 %% âŸ¨âŸ©
0 (â€¢MakeRand 0).Subset 0 %% âŸ¨âŸ©
{!(âˆ§â€¢rand.Deal ğ•©)â‰¡â†•ğ•©}Â¨ â¥Š Â¯1â€¿0â€¿1+âŒœ2â‹†â†•22 # %SLOW
!"(rand).Range: Result rank too large (256â‰¡â‰¢ğ•¨)" % (256â¥Š1) â€¢rand.Range 0
! â‰¡Ë aâ†{râ†â€¢MakeRand ğ•© â‹„ âŸ¨r.Range 1e9, 100 r.Range 1e9, r.Deal 100, 100 r.Deal 200, 100 r.Deal 200, 100 r.Subset 200âŸ©}Â¨ 2â€¿2â¥Šâ†•2 â‹„ !âˆ˜â‰¢Â¨Â´ âŠa
râ†â€¢MakeRand 1 â‹„ ! 1Â¨âŠ¸â‰¡ âˆŠ{ğ•Š: 800 r.Subset 1000}Â¨ â†•4
râ†â€¢MakeRand 1 â‹„ ! 1Â¨âŠ¸â‰¡ âˆŠ{ğ•Š: 50 r.Subset 10000}Â¨ â†•4
râ†â€¢MakeRand 1 â‹„ ! 1Â¨âŠ¸â‰¡ âˆŠ{ğ•Š: 10    r.Range 10000}Â¨ â†•4
râ†â€¢MakeRand 1 â‹„ ! 1Â¨âŠ¸â‰¡ âˆŠ{ğ•Š: 10â€¿10 r.Range 128}Â¨ â†•4
râ†â€¢MakeRand 1 â‹„ ! 1Â¨âŠ¸â‰¡ âˆŠ{ğ•Š:     r.Deal 1000}Â¨ â†•4
râ†â€¢MakeRand 1 â‹„ ! 1Â¨âŠ¸â‰¡ âˆŠ{ğ•Š: 500 r.Deal 1000}Â¨ â†•4

# â€¢bit
!"â€¢bit._cast: ğ•© must have rank at least 1" % 8â€¿1 â€¢bit._cast 123
(â†•10) {! (ğ•¨â¥ŠÂ¯1) â‰¡ 1â€¿ğ•©â€¢bit._cast (ğ•¨Ã—ğ•©)â¥Š1}âŒœ 8â€¿16â€¿32
%USE var â‹„ {tâ†ğ•©âŠ1â€¿8â€¿16â€¿32â€¿64 â‹„ !âˆ˜â‰¡Â¨âŸœâŠ râ†{tâ€¢bit._cast ğ•© V a}Â¨ LV aâ†  â†•128 â‹„ âŠ‘âŠ‘r}Â¨ â†•4â€¿4
%USE var â‹„ {tâ†ğ•©âŠ1â€¿8â€¿16â€¿32â€¿64 â‹„ !âˆ˜â‰¡Â¨âŸœâŠ râ†{tâ€¢bit._cast ğ•© V a}Â¨ LV aâ†4=â†•128 â‹„ âŠ‘âŠ‘r}Â¨ â†•4â€¿4
! 10â€¿1 â‰¡ â‰¢8â€¿16â€¢bit._cast câ†0â†“2â†•'a'+11 â€¢rand.Range 26 â‹„ ! 10â€¿2 â‰¡ â‰¢c
! 10â€¿1 â‰¡ â‰¢8â€¿16â€¢bit._cast câ†  2â†•'a'+11 â€¢rand.Range 26 â‹„ ! 10â€¿2 â‰¡ â‰¢c
âŠ‘ 8â€¿32â€¢bit._cast 3â†“â†•7 %% 100992003

# â€¢platform
Str â† {!=ğ•© â‹„ !Ã—â‰ ğ•© â‹„ ! âˆ§Â´2=â€¢TypeÂ¨ğ•©} â‹„ Str â€¢platform.os â‹„ Str â€¢platform.cpu.arch â‹„ Str â€¢platform.bqn.impl_version â‹„ Str â€¢platform.environment
â€¢platform.bqn.impl %% "CBQN"





# CBQN-specific extensions

# â€¢_while_
1âŠ¸+â€¢_while_{ğ•Š: âˆ§Â´ğ•©â‰¤20} â†•10 %% 12+â†•10
(10â¥Š1) +â€¢_while_{ğ•Š: âˆ§Â´ğ•©â‰¤20} â†•10 %% 12+â†•10

# â€¢Hash
! â‰¡Â´  â€¢HashÂ¨ 2â¥Š<âŸ¨10,"ab"âŸ©
! â‰¡Â´1 â€¢HashÂ¨ 2â¥Š<âŸ¨10,"ab"âŸ©

# â€¢ToUTF8 & â€¢FromUTF8
@-Ëœâ€¢ToUTF8 "ğ•©â‰hello" %% 240â€¿157â€¿149â€¿169â€¿226â€¿141â€¿137â€¿104â€¿101â€¿108â€¿108â€¿111
! â€¢FromUTF8âˆ˜â€¢ToUTF8âŠ¸â‰¡ "ğ•©â‰hello"
(
  %USE tvar
  ipâ†â‹ˆÂ¨ iâ†@+â·0âŒˆâˆ§(â¥Š(Â¯5+â†•11)+âŒœ2â‹†â†•20)âˆ¾1114111-â†•10
  {! ğ•©â‰¡â€¢FromUTF8â€¢ToUTF8 ğ•© â‹„ !âˆ˜â‰¡Â¨âŸœâŠ â€¢ToUTF8 _tvar ğ•©}Â¨ â†‘i
  t â† â€¢ToUTF8Â¨ ip
  ! (âˆ¾t)â‰¡â€¢ToUTF8 i
  ! ip â‰¡ â€¢FromUTF8Â¨ t
  ! (â‰ Â¨t) â‰¡ Â¯1â†“+`/â¼0â€¿49â€¿93â€¿148â€¿197
)

# â€¢internal.GC
â€¢internal.GC â†•10 %% 1
# â€¢internal.Type & â€¢internal.Variation & â€¢internal.ElType & â€¢internal.ListVariations
(
  raw â† {("a"âŠ¸â‹ˆÂ¨ ğ•©)âˆ¾"s"âŠ¸â‹ˆÂ¨ 1â†“ğ•©} âŸ¨"b","i8","i16","i32","f64","c8","c16","c32","h","f"âŸ©
  var â† {aâ€¿e: âˆ¾âŸ¨a-32, eâŸ©}Â¨ raw
  ty â† {âˆ¾âŒ½ {"a":"arr";"slice"}â€¿{"b":"bit"; "f":"fill"; ğ•©} {ğ•ğ•©}Â¨ ğ•©}Â¨ raw
  ty {"type"â€¿ğ•¨â€¿ğ•© ! ğ•¨ â‰¡ â€¢internal.Type ğ•© â€¢internal.Variation âŸ¨âŸ©}Â¨ var
  ! 0â€¿1â€¿2â€¿3â€¿4â€¿5â€¿6â€¿7â€¿8â€¿8â€¿1â€¿2â€¿3â€¿4â€¿5â€¿6â€¿7â€¿8â€¿8 â‰¡ {â€¢internal.ElType ğ•© â€¢internal.Variation âŸ¨âŸ©}Â¨ var
  # TODO test â€¢internal.ListVariations
)

# â€¢internal.Keep
â€¢internal.Keep â†•10 %% â†•10
!"This function can't be called dyadically" % 1 â€¢internal.Keep 1
# â€¢internal.Refc
â€¢internal.Refc â€¢internal.Unshare â†•10 %% 1
aâ†â€¢internal.Unshare â†•10 â‹„ bâ†10â¥Š<a â‹„ ! 11 â‰¡ â€¢internal.Refc a â‹„ â€¢internal.Keep b
# â€¢internal.IsPure
! 1 â‰¡ â€¢internal.IsPure âŠ‘âŸ¨+âŸ©
! 1 â‰¡ â€¢internal.IsPure âŠ‘âŸ¨âŠ‘âˆ˜+Â¨++âŸ©
! 1 â‰¡ â€¢internal.IsPure âŠ‘âŸ¨âŠ‘âŸœ1â€¿2â€¿3âˆ˜+Â¨++âŸ©
! 1 â‰¡ â€¢internal.IsPure âŠ‘âŸ¨âŠ¢â—¶âŠ¢â€¿-âŸ©
! 0 â‰¡ â€¢internal.IsPure âŠ‘âŸ¨âŠ¢â—¶{ğ•©}â€¿-âŸ©
! 0 â‰¡ â€¢internal.IsPure âŠ‘âŸ¨âŠ‘âŸœ1â€¿2â€¿{ğ•©}âˆ˜+Â¨++âŸ© # could be 1
! 0 â‰¡ â€¢internal.IsPure â€¢show
! 0 â‰¡ â€¢internal.IsPure â€¢file.chars
# â€¢internal.Info
â€¢internal.Info 1 %% "3ff0000000000000: not heap-allocated"
33â†‘â€¢internal.Info â€¢internal.Unshare â†•10 %% "fff7: refc:1 type:23=i8arr alloc:"
# â€¢internal.HasFill
â€¢internal.HasFillÂ¨ âŸ¨â†•0, â†•10, âŸ¨âŸ©, 'a'â€¿1, ""âŸ© %% 1â€¿1â€¿0â€¿0â€¿1
# â€¢internal.Squeeze
aâ†"Ai32"â€¢internal.Variation â†•10 â‹„ â€¢internal.Type â€¢internal.Squeeze a %% "i8arr"
# â€¢internal.DeepSqueeze
aâ†â‹ˆ"Ai32"â€¢internal.Variation â†•10 â‹„ â€¢internal.Type âŠ‘â€¢internal.DeepSqueeze a %% "i8arr"
# â€¢internal.ClearRefs
â€¢internal.ClearRefs@ â‹„ â€¢internal.VariationâŸœ(â†•10)Â¨ 10â¥Š<"Ai32Inc" â‹„ â€¢internal.ClearRefs "foo" %% 10
# â€¢internal.Unshare
â€¢internal.Refcâˆ˜â€¢internal.UnshareÂ¨ âŸ¨â†•0, "", âŸ¨âŸ©, â†•10âŸ© %% 1â€¿1â€¿1â€¿1
# â€¢internal.EEqual
%USE nan â‹„ aâ†1âŒ½nansâˆ¾â€¢ParseFloatÂ¨"0"â€¿"1.2"â€¿"-0" â‹„ a â€¢internal.EEqual âŒ½a %% 1
