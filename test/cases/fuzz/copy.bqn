### WHOLE-FILE-TEST
# tests full array copying via â€¢internal.Variation
helpers â† âŠ‘â€¢args
R â† (helpers.GetRand@).Range
âŸ¨Variation, ListVariations, ClearRefsâŸ© â‡ â€¢internal

vn â† "Ab"â€¿"Ai8"â€¿"Ai16"â€¿"Ai32"â€¿"Af64"â€¿"Ac8"â€¿"Ac16"â€¿"Ac32"â€¿"Ah"â€¿"Af"
vi â†âŸ¨0,   0,    0,     0,     1,     2,    2,     2,     1,   1âŸ©

vf â† âˆ¾âŸ¨
  â†“âŸœ(5â†‘  vn)Â¨ â†•5
  â†“âŸœ(3â†‘5â†“vn)Â¨ â†•3
  âŸ¨âŸ©â€¿âŸ¨âŸ©
âŸ©
vf â†© âˆ¾âŸœ(8â†“vn)Â¨ vf
vf â†© (â†•10) {ğ•© âˆ¾ 'S'âˆ¾Â¨ 1â†“Â¨ (ğ•¨=0)â†“ğ•©}Â¨ vf
vf â†© {ğ•© âˆ¾ âˆ¾âŸœ"Inc"Â¨ ğ•©}Â¨ vf

# â€¢ShowÂ¨ vf

count â† 10000
eqlen â† 0

{ğ•Š:
  n â† R 2â‹†5+R 9
  shl â† 1âŠ¸+â€¢_while_{(R 2)âˆ§0=1|nÃ·2â‹†ğ•©+1} 0
  sh â† (nÃ·2â‹†shl)âˆ¾shlâ¥Š2
  {ğ•Š: shâ†©âŸ¨âŸ©}âŸâŠ¢ (n=1) âˆ§ 0=R 2
  
  ! n â‰¡ Ã—Â´sh
  v â† R â‰ vn
  l â† sh â¥Š âŠ¢â—¶âŸ¨
    {ğ•Š: (vâŠ‘0âˆ¾2â‹†6â€¿14â€¿30) -Ëœ n R 2â‹†vâŠ‘1â€¿7â€¿15â€¿31}
    {ğ•Š: Ã·n R 0}
    {ğ•Š: @+n R (v-5)âŠ‘256â€¿65536â€¿1114112}
  âŸ© vâŠ‘vi
  
  vs â† vâŠ‘vf
  vsLV â† ListVariations l
  
  { ğ•Š v0:
    a0 â† v0 Variation l
    ! a0 â‰¡ l
    { ğ•Š:
      a1 â† ğ•© Variation a0
      a0 â‰¡ a1?1;
      â€¢Out "fail:"
      â€¢Show v0â€¿"â†’"â€¿ğ•©
      !0
    }Â¨ vs
  }Â¨ vs
  ClearRefs@
  eqlen+â†© (â‰ vs) â‰¡ +Â´â¥Švsâ‰¡âŒœvsLV
}Â¨ â†•count

â€¢Out "Fraction of matching variation count to ListVariations: "âˆ¾(â€¢Repr eqlenÃ·count)âˆ¾" (expected: ~0.999)"