### WHOLE-FILE-TEST
# tests if squeeze produces valid results
helpers â† âŠ‘â€¢args
r â† helpers.GetRand@
âŸ¨EEqual, ListVariations, ClearRefs, Variation, Unshare, Squeeze, InfoâŸ© â† â€¢internal
âŸ¨RandVals, vars, spec, specF64âŸ© â† âŸ¨râŸ© helpers.Import "utils.bqn"

TestSq0 â† {a â† Squeeze ğ•¨ Variation ğ•© â‹„ ! 1==a â‹„ ! 0=â‰ a â‹„ a}
{! âŸ¨0âŸ©â‰¡1â†‘ğ•© TestSq0 â†•0}Â¨ 5â†‘vars
{! " "â‰¡1â†‘ğ•© TestSq0 ""}Â¨ 5â†“vars
{ğ•© TestSq0 âŸ¨âŸ©}Â¨ ListVariations âŸ¨âŸ© # {ğ•©{â€¢Out "Failed fill for "âˆ¾ğ•¨}âŸâŠ¢ 8 â‰  1â†‘âŠ8 ğ•© TestSq0 âŸ¨âŸ©}Â¨ ListVariations âŸ¨âŸ© # %ALLOW_CATCH

specSpl â† 5(â†‘â‹ˆâ†“)spec
allSpec â† specF64 âˆ¾ (@+0â€¿10â€¿32â€¿127â€¿128â€¿255â€¿256â€¿32767â€¿32768â€¿65535â€¿65536â€¿1114110â€¿1114111) âˆ¾ {â‡}â€¿+
Do â† { ğ•Š:
  at â† r.Range 8
  l â† 1 + r.Range (at=0)âŠ‘1000â€¿300
  a â† l RandVals at
  {! a EEqual Squeeze ğ•© Variation a}Â¨ ListVariations a
  
  F â† { ğ•Š:
    p â† {r.Range 2? r.Range l; (Â¯1+l-âŠ¢)âŸ(r.Range 2) r.Range (2â‹†r.Range 10)âŒŠl}
    b â† ğ•©Ë™âŒ¾(pâŠ¸âŠ‘) a
    b0 â† Unshare b
    Â¬b0 EEqual Squeeze b?
      â€¢Out "Fail:"
      â€¢Out "Array: "âˆ¾â€¢Repr b
      â€¢Out "Squeezed: "âˆ¾â€¢Repr Squeeze b
      !0
    ;@
  }
  
  FÂ¨ (atâ‰¥5)âŠ‘specSpl
  FÂ¨ allSpec
  {ğ•Š: FÂ¨ @âŠ¸+âŸ(atâ‰¥5) r.Range 2â‹†r.Range (atâ‰¥5)âŠ‘33â€¿20}Â¨ â†•10
  ClearRefs@
}

DoâŸ40000 @
