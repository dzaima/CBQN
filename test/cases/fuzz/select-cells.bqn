%DEF var Vâ†â€¢internal.Variation â‹„ LVâ†â€¢internal.ListVariations â‹„ CLRâ†â€¢internal.ClearRefs
%DEF tvar %USE var â‹„ _tvar â† {F _ğ•£ x: (CLR@) âŠ¢ {F ğ•© V x}Â¨ LV ğ•©; w F _ğ•£ x: (CLR@) âŠ¢ (LV ğ•¨) {(ğ•¨ V w) F ğ•© V x}âŒœ LV ğ•©}
%DEF eqvar %USE tvar â‹„ _eqvar â† {r â† ğ•¨ ğ”½ _tvar ğ•© â‹„ !âˆ˜â‰¡âŸœ(âŠ‘r)Â¨ r â‹„ âŠ‘r}

(
  %USE eqvar
  LV â†© ""âŠ¸LV
  Test â† { ğ•Š:
    x â† (2â€¢rand.Range 50)â€¢rand.Range 100
    w â† {0: â†•0; (1+â€¢rand.Range 50) â€¢rand.Range ğ•©} 1âŠ‘â‰¢x
    w {ğ•¨âŠ¸âŠË˜ ğ•©}_eqvar x
  }
  
  TestÂ¨ â†•1000
)

(
  Test â† {ğ•Š gen:
    { ğ•Š cam:
      {
        i â† â€¢rand.Rangeâˆ˜3â—¶âŸ¨âŠ¢, Â¯1âŠ¸-, {ğ•© - (1+2Ã—ğ•©) Ã— 2â€¢rand.RangeËœâ‰ ğ•©}âŸ© ğ•¨ â€¢rand.Range ğ•©
        ! (iâŠ¸âŠË˜ â‰¡ iâŠ¸âŠâ—‹â€¢internal.KeepË˜) Gen camâ€¿ğ•©
      }âŒœËœ 1â†“â·(â†•20)âˆ¾âŒŠ(âˆš2)â‹†â†•16
    }Â¨ 1â€¿6â€¿100
  }
  
  Test {{0 + ğ•© â€¢rand.Range 100}}
  Test {{0 + ğ•© â€¢rand.Range 1000}}
  Test {{0 + ğ•© â€¢rand.Range 1e9}}
  Test {{0 + ğ•© â€¢rand.Range 0}}
  
  Test {{@ + ğ•© â€¢rand.Range 100}}
  Test {{@ + ğ•© â€¢rand.Range 1000}}
  Test {{@ + ğ•© â€¢rand.Range 1114111}}
  Test {{âŠ‘âŸœ"foo"â€¿@Â¨ ğ•© â€¢rand.Range 2}}
)


(
  %USE var
  F â† {ğ•¨âŠ¸âŠË˜ ğ•©}
  {
    ğ•©+â†© 1
    is â† ğ•¨ â€¢rand.Range ğ•©
    n â† â€¢rand.Range 200
    d â† nâ€¿ğ•©â€¢rand.Range 2
    isâ€¿nâ€¿ğ•© ! 1=â‰ â· âŸ¨is F d, is F "Ai8"V dâŸ© âˆ¾ {ğ•©=2? âŸ¨("Ai8"V is) F dâŸ©; âŸ¨âŸ©}ğ•©
  }âŒœËœ â†•10
)

(
  %USE var
  F â† {ğ•¨âŠ¸âŠË˜ ğ•©}âŠ'e'
  {
    ğ•©+â†© 1
    ğ•¨+â†© 1
    is â† ğ•¨â¥Šğ•©
    n â† 1+â€¢rand.Range 200
    d â† nâ€¿ğ•©â€¢rand.Range 2
    
    ğ•¨â€¿ğ•©â€¿n! âˆ§Â´ 'e'âŠ¸â‰¡Â¨ âŸ¨is F d, is F "Ai8"V dâŸ© âˆ¾ {ğ•©=2? âŸ¨("Ai8"V is) F dâŸ©; âŸ¨âŸ©}ğ•©
  }âŒœËœ â†•10
)

(
  %USE var
  F â† {ğ•¨âŠ¸âŠË˜ ğ•©}âŠ'e'
  
  {ğ•Š inds:
    csz â† â‰ âŠ‘inds
    inds {
      âŸ¨csz, ğ•¨, â‰¢ğ•©âŸ© ! 1=â‰ â· â¥Š (VâŸœğ•¨Â¨ (âˆ§Â´ğ•¨â‰¤1)â—¶âŸ¨â‹ˆ, "Ab"âŠ¸â‹ˆâŸ© "Ai8") FâŒœ VâŸœğ•©Â¨ "Ab"â€¿"Ai8"â€¿"Ai32"
    }âŒœ {ğ•©â€¿csz â€¢rand.Range 2}Â¨ (â†•8)âˆ¾â¥Š0â€¿1+âŒœ3â†“2â‹†â†•9
  }Â¨ âŸ¨â¥Šâ†•2â€¿2âŸ© âˆ¾ {âŸ¨â†•ğ•©, â€¢rand.RangeËœğ•©âŸ©}Â¨ 1â€¿3â€¿4â€¿5â€¿8â€¿9â€¿16
)