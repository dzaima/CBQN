%DEF eqvar âŸ¨_eqvarâŸ©â†âŠ‘â€¢args

# some checks for behavior around Â¯0; not strictly necessary to stay, but other tests will probably become meaningless without these!
1âŠ64â€¿1â€¢bit._cast â‰Ë˜ â€¢ParseFloatÂ¨ "1.2"â€¿"-0" %% 63â€¿1/0â€¿1
! (4â¥Š0) (â‰¡ âˆ§ â‰¢â—‹(64â€¿1â€¢bit._castâŠ¢)) 1â†“Â¯1Ã—Ï€âˆ¾4â¥Š0
! â‰¢Ë64â€¿1â€¢bit._cast â‰Ë˜0â€¿5âŠâ¥Š(Â¯1âŠ¸Ã—â‰âŠ¢) (â†•3)âˆ¾âˆâˆ¾0Ã·0

# Â¯0
! â‰¡Â´ {â€¢Hash â€¢ParseFloatÂ¨ ğ•©â€¿"1.2"}Â¨ "0"â€¿"-0"
! 1â€¿0 â‰¡ âˆŠ{â€¢ParseFloatÂ¨ ğ•©â€¿"1.2"}Â¨ "0"â€¿"-0"
aâ†(â€¢ParseFloatÂ¨ "1.2"â€¿"-0"â€¿"0")âˆ¾-âŠ¸â‹ˆ0Ã·0 â‹„ âˆŠ1â€¢HashÂ¨ a %% 1â€¿1â€¿0â€¿1â€¿0
aâ†(â€¢ParseFloatÂ¨ "1.2"â€¿"-0"â€¿"0")âˆ¾-âŠ¸â‹ˆ0Ã·0 â‹„ bâ†0+--a â‹„ ! a â€¢internal.EEqual b â‹„ ! a â‰¡â—‹(3âŠ¸â†‘) b â‹„ ! 0â‰¡a â€¢Cmp b â‹„ ! a â‰¡â—‹(1âŠ¸â€¢HashÂ¨) b â‹„ ! a â‰¡â—‹(1âŠ¸â€¢Hash) b
aâ†(â€¢ParseFloatÂ¨ "1.2"â€¿"-0"â€¿"0")âˆ¾-âŠ¸â‹ˆ0Ã·0 â‹„ ! (0â€¿3â€¿3â€¿3âŠa) â‰¡â—‹â€¢Hash (0â€¿4â€¿4â€¿4âŠa)

# functions
â·âŸ¨âŠ¢âŠ¢âŠ¢, âŠ¢âŠ¢âŠ¢, +âŠ¢âŠ¢, âŠ¢+âŠ¢, âŠ¢âŠ¢+, âŠ¢âŠ¢, âŠ¢âŠ¢, âŠ¢+, 1âŠ¸+, 1âŠ¸+, 2âŠ¸+, 1âŸœ+, 1âŠ¸Ã—, âŠ¢+âŠ¢, âŠ¢âŠ¢âŠ¢, +âŠ¢âŠ¢, +Ë˜, Ã—Ë˜, +Ë˜, +ËâŸ© %% âŸ¨âŠ¢âŠ¢âŠ¢, +âŠ¢âŠ¢, âŠ¢+âŠ¢, âŠ¢âŠ¢+, âŠ¢âŠ¢, âŠ¢+, 1âŠ¸+, 2âŠ¸+, 1âŸœ+, 1âŠ¸Ã—, +Ë˜, Ã—Ë˜, +ËâŸ©

# various
[1â€¿1, 0â€¿1, 1â€¿0, 0â€¿0, 1â€¿1, 0â€¿0] âˆŠ [0â€¿0, 0â€¿1, 1â€¿0] %% 0â€¿1â€¿1â€¿1â€¿0â€¿1
[[0â€¿0, 0â€¿1, 1â€¿0, 1â€¿1], [1â€¿1, 0â€¿1, 1â€¿0, 0â€¿0]] âˆŠ [0â€¿0, 0â€¿1, 1â€¿0] %% 2â€¿4â¥Š1â€¿1â€¿1â€¿0â€¿0â€¿1â€¿1â€¿1
[1â€¿1, 0â€¿1, 1â€¿0, 0â€¿0, 1â€¿1, 0â€¿0] âˆŠâ—‹(â‰â‰0) [0â€¿0, 0â€¿1, 1â€¿0] %% 0â€¿1â€¿1â€¿1â€¿0â€¿1
[[0â€¿0, 0â€¿1, 1â€¿0, 1â€¿1], [1â€¿1, 0â€¿1, 1â€¿0, 0â€¿0]] âˆŠâ—‹(â‰â‰0) [0â€¿0, 0â€¿1, 1â€¿0] %% 2â€¿4â¥Š1â€¿1â€¿1â€¿0â€¿0â€¿1â€¿1â€¿1
âŠËœâˆ¾Ëœ"ihxtIddKLp"â€¿'r'â€¿Ã·â€¿"EXiRowcDXx"â€¿'a'â€¿"ZNtqFbDCYZ"â€¿â’â€¿0.05369125494326554â€¿â†‘â€¿5 %% âˆ¾Ëœâ†•10
0â€¿1âˆŠËœâŸ¨"ab","cd"âŸ© %% 0â€¿0
0â€¿1âŠ âŸ¨"ab","cd"âŸ© %% 2â€¿2
(<"ab")âˆŠ"ab"â€¿"cd" %% <1
(<"cd")âˆŠ"ab"â€¿"cd" %% <1
(<"ef")âˆŠ"ab"â€¿"cd" %% <0
(127â¥Š"abc")âŠ"abcd" %% 0â€¿1â€¿2â€¿127
(128â¥Š"abc")âŠ"abcd" %% 0â€¿1â€¿2â€¿128
(32767â¥Š"abc")âŠ"abcd" %% 0â€¿1â€¿2â€¿32767
(32768â¥Š"abc")âŠ"abcd" %% 0â€¿1â€¿2â€¿32768
(127â¥Š"abc")âŠ100â¥Š"ababacadabacaba" %% (100â¥Š0â€¿1â€¿0â€¿1â€¿0â€¿2â€¿0â€¿  127â€¿0â€¿1â€¿0â€¿2â€¿0â€¿1â€¿0)
(128â¥Š"abc")âŠ100â¥Š"ababacadabacaba" %% (100â¥Š0â€¿1â€¿0â€¿1â€¿0â€¿2â€¿0â€¿  128â€¿0â€¿1â€¿0â€¿2â€¿0â€¿1â€¿0)
(32767â¥Š"abc")âŠ100â¥Š"ababacadabacaba" %% (100â¥Š0â€¿1â€¿0â€¿1â€¿0â€¿2â€¿0â€¿32767â€¿0â€¿1â€¿0â€¿2â€¿0â€¿1â€¿0)
(32768â¥Š"abc")âŠ100â¥Š"ababacadabacaba" %% (100â¥Š0â€¿1â€¿0â€¿1â€¿0â€¿2â€¿0â€¿32768â€¿0â€¿1â€¿0â€¿2â€¿0â€¿1â€¿0)
â· â€¢internal.VariationâŸœ(â†•1)Â¨ "Ab"â€¿"Ai8" %% âŸ¨â‹ˆ0âŸ©
%USE eqvar â‹„ 0âŠ¸â€¢Hash _eqvar â†•5
%USE eqvar â‹„ 0âŠ¸â€¢Hash _eqvar "hello"
%USE eqvar â‹„ 0âŠ¸â€¢Hash _eqvar â†•â‹ˆ10

{bâ†â€¢internal.Unshare aâ†"Ai8"â€¢internal.Variation âˆ¾âŸ¨16â¥Š0â€¿0â€¿0â€¿0â€¿0â€¿0â€¿0â€¿Â¯128, 8â¥Š0, 8â†‘2âŸ© â‹„ câ†8â€¿64â€¢bit._cast a â‹„ ! 1â€¿0â€¿0â€¿1â‰¡âˆŠc â‹„ â€¢internal.Keep â€¢Hash c â‹„ ! aâ‰¡b} # make sure sign bit doesn't mutate away

# error messages
!"ğ•¨âˆŠğ•©: ğ•© cannot have rank 0" % 1â€¿2â€¿3âˆŠ0
!"ğ•¨âŠğ•©: ğ•¨ cannot have rank 0" % 0âŠ1â€¿2â€¿3
!"ğ•¨âŠ’ğ•©: ğ•¨ cannot have rank 0" % 0âŠ’1â€¿2â€¿3
!"ğ•¨âˆŠğ•©: Rank of ğ•¨ must be at least the cell rank of ğ•© (âŸ¨2âŸ© â‰¡ â‰¢ğ•¨, 2â€¿2â€¿2 â‰¡ â‰¢ğ•©)" % 1â€¿2âˆŠ2â€¿2â€¿2â¥Š1â€¿2
!"ğ•¨âŠğ•©: Rank of ğ•© must be at least the cell rank of ğ•¨ (2â€¿2â€¿2 â‰¡ â‰¢ğ•¨, âŸ¨2âŸ© â‰¡ â‰¢ğ•©)" % (2â€¿2â€¿2â¥Š1â€¿2)âŠ1â€¿2
!"ğ•¨âŠ’ğ•©: Rank of ğ•© must be at least the cell rank of ğ•¨ (2â€¿2â€¿2 â‰¡ â‰¢ğ•¨, âŸ¨2âŸ© â‰¡ â‰¢ğ•©)" % (2â€¿2â€¿2â¥Š1â€¿2)âŠ’1â€¿2

# hashmap
("abc"â€¿"de"â€¿"fgh" â€¢HashMap â¥ŠÂ¨â†•3).Get "fgh" %% âŸ¨2âŸ©
âˆ ("abc"â€¿"de"â€¿"fgh" â€¢HashMap â¥ŠÂ¨â†•3).Get "fghi" %% âˆ
("abc"â€¿"de"â€¿"fgh" â€¢HashMap â¥ŠÂ¨â†•3).Count"xy" %% 3
("b" ("a"â€¿"b" â€¢HashMap "A"â€¿"C").Set "B").Get "b" %% "B"
((â€¢HashMapËœâ†•4).SetÂ´ 1â€¿"one").Keysâ†•2 %% â†•4
(((â€¢HashMapËœâ†•4).Delete 1).SetÂ´ 1â€¿"one").Keys@ %% 0â€¿2â€¿3â€¿1
(((â€¢HashMapËœâ†•4).Delete 1).SetÂ´ 1â€¿"one").Values@ %% 0â€¿2â€¿3â€¿"one"
({ğ•©.SetÂ´"xy"}âŸ4â€¢HashMapËœâ†•0).Count@ %% 1
!"ğ•¨ â€¢HashMap ğ•©: Arguments must be lists (âŸ¨âŸ©â‰¡â‰¢ğ•¨, âŸ¨3âŸ©â‰¡â‰¢ğ•©)" % 'a' â€¢HashMap "str"
!"ğ•¨ â€¢HashMap ğ•©: ğ•¨ and ğ•© must have the same length (4â‰¡â‰ ğ•¨, 3â‰¡â‰ ğ•©)" % "stri" â€¢HashMap "str"
!"â€¢HashMap: ğ•¨ contained duplicate keys" % "strs" â€¢HashMap "stri"
!"(hashmap).Get: key not found" % ("abc"â€¿"de"â€¿"fgh" â€¢HashMap â¥ŠÂ¨â†•3).Get "fg"
!"(hashmap).Delete: key not found" % ("abc"â€¿"de"â€¿"fgh" â€¢HashMap â¥ŠÂ¨â†•3).Delete 'a'
m â† 1â€¿2 â€¢HashMap vâ†â€¢internal.Unshare 'a'â€¿4 â‹„ 1 m.Set 9 â‹„ âŸ¨v, m.Keys@, m.Values@âŸ© %% âŸ¨'a'â€¿4, 1â€¿2, 9â€¿4âŸ©
m â† 1â€¿2 â€¢HashMap â€¢internal.Unshare 'a'â€¿4 â‹„ vâ†m.Values@ â‹„ 1 m.Set 9 â‹„ âŸ¨v, m.Keys@, m.Values@âŸ© %% âŸ¨'a'â€¿4, 1â€¿2, 9â€¿4âŸ©
