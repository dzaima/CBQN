%DEF k _k â† {ğ”½â—‹â€¢internal.Keep}
%DEF tcc %USE k â‹„ _tcc â† { ! âˆ§Â´ (<ğ•¨ ğ”½_kË˜âŠ'e' ğ•©) â‰¡Â¨ (ğ•¨ ğ”½Ë˜âŠ'e'â€¢internal.VariationâŸœğ•©)Â¨ "i"â€¢internal.ListVariations ğ•©}

1â€¿2 1â‰0 1 %% 1â€¿1
1 1â‰0 1â€¿2 %% 1â€¿1
! 20â€¿1200â‰¡â‰¢â¥ŠË˜aâ†20â€¿30â€¿40â¥Šâ†•24 â‹„ ! 20â€¿30â€¿40 â‰¡ â‰¢a
! (2âŠ¸-â‰1 â‰¡ {2-ğ•©}â‰1) 10â€¿10â¥Šâ†•100
! (-âŸœ2â‰1 â‰¡ {ğ•©-2}â‰1) 10â€¿10â¥Šâ†•100
%USE k â‹„ nâ†1 â‹„ â‰ {ğ•Š: (â€¢Repr a) ! (â‰¡â‰n â‰¡ â‰¡_kâ‰n)Â´ aâ†(âŠâŸœ(3â€¿2â€¿2â¥Š'a'+â†•26))Â¨ <Ë˜ 2â€¿2â€¿2â€¿2â€¢rand.Range 3}Â¨ â†•1000
%USE k â‹„ nâ†2 â‹„ â‰ {ğ•Š: (â€¢Repr a) ! (â‰¡â‰n â‰¡ â‰¡_kâ‰n)Â´ aâ†(âŠâŸœ(3â€¿2â€¿2â¥Š'a'+â†•26))Â¨ <Ë˜ 2â€¿2â€¿2â€¿2â€¢rand.Range 3}Â¨ â†•1000
%USE k â‹„ nâ†3 â‹„ â‰ {ğ•Š: (â€¢Repr a) ! (â‰¡â‰n â‰¡ â‰¡_kâ‰n)Â´ aâ†(âŠâŸœ(3â€¿2â€¿2â¥Š'a'+â†•26))Â¨ <Ë˜ 2â€¿2â€¿2â€¿2â€¢rand.Range 3}Â¨ â†•1000
â‰ {ğ•Šk: ! (3âŠ¸â†‘â‰k â‰¡ {3â†‘ğ•©}â‰k) 2â€¿2â€¿2â€¿2â¥Šâ†•16}Â¨ Â¯2+â†•10
â‰ {ğ•Šk: ! (1âŠ¸â†“â‰k â‰¡ {1â†“ğ•©}â‰k) 3â€¿3â€¿3â€¿3â¥Šâ†•81}Â¨ Â¯2+â†•10

!"Ë˜: Result rank too large" % (0âˆ¾254â¥Š2)âŠ¸â¥Šâˆ˜1Ë˜ 0â€¿2â¥Š1
!"â‰: Result rank too large" % (0âˆ¾254â¥Š2)âŠ¸â¥Šâˆ˜1â‰Â¯1 0â€¿2â¥Š1
!"â‰: Result rank too large" % (1â¥ŠËœ 0âˆ¾204â¥Š2)â‰50 1â¥ŠËœ 0âˆ¾100â¥Š2
!"â‰: Result rank too large (204 â‰¡ =ğ•©, 200 â‰¡ =ğ”½v)" % {ğ•Š:(200â¥Š1)â¥Š1}â‰1 (205â¥Š1)â¥Š1

!"â‰: Argument frames don't agree (âŸ¨3âŸ© â‰¡ â‰¢ğ•¨, âŸ¨2âŸ© â‰¡ â‰¢ğ•©, common frame of 1 axes)" % "abc" âŠ¢â‰0 "ab"
!"Ë˜: Argument frames don't agree (âŸ¨3âŸ© â‰¡ â‰¢ğ•¨, âŸ¨2âŸ© â‰¡ â‰¢ğ•©, common frame of 1 axes)" % "abc" âŠ¢Ë˜ "ab"
! âˆ§Â´{ğ•Š: ! (âˆ¾â‰¡{ğ•¨âˆ¾ğ•©}Â´) (<â€¢rand.Rangeâˆ˜â‰ âŠ¸âŠ‘ âŸ¨"ab",1â€¿2,âŸ¨âŸ©,â†•0,""âŸ©) âˆ¾Ëœ (4â€¢rand.Rangeâ‰ )âŠ¸âŠ âŸ¨1, {â‡}, 'a', <'a', <{â‡}, "ab", â†•0, ""âŸ©}Â¨â†•10000

%USE tcc â‹„ âŸ¨2, 20, Â¯2, Â¯20, 0âŸ© {ğ•¨ â†‘_tcc ğ•© â‹„ ğ•¨ â†“_tcc ğ•©}âŒœ âŸ¨<4, â†•5, 4â€¿5â¥Šâ†•20, 4â€¿5â€¿6â¥Šâ†•120âŸ©
%USE tcc â‹„ âŸ¨<, â‰, âŠ, â¥ŠâŸ© {ğ• _tcc ğ•©}âŒœ âŸ¨<4, â†•5, 4â€¿5â¥Šâ†•20, 4â€¿5â€¿6â¥Šâ†•120, 2â€¿3â€¿4â€¿5â¥Šâ†•120âŸ©
%USE tcc â‹„ âŸ¨<, â‰, â¥ŠâŸ© {ğ• _tcc ğ•©}âŒœ âŸ¨<4, â†•5, 4â€¿5â¥Šâ†•20, 4â€¿5â€¿6â¥Šâ†•120, 2â€¿3â€¿4â€¿5â¥Šâ†•120âŸ©
%USE tcc â‹„ âŸ¨âŠâŸ© {ğ• _tcc ğ•©}âŒœ âŸ¨4â€¿5â¥Šâ†•20, 4â€¿5â€¿6â¥Šâ†•120, 2â€¿3â€¿4â€¿5â¥Šâ†•120âŸ©
%USE tcc â‹„ âŠ_tcc 4â€¿2â¥Šâ†•8 â‹„ 1âŠ_tcc 4â€¿2â¥Šâ†•8 â‹„ âŠ_tcc â†•4â€¿2 â‹„ 1âŠ_tcc â†•4â€¿2
%USE tcc â‹„ âŠ‘_tcc 4â€¿2â¥Šâ†•8 â‹„ 1âŠ‘_tcc 4â€¿2â¥Šâ†•8 â‹„ âŠ‘_tcc â†•4â€¿2 â‹„ 1âŠ‘_tcc â†•4â€¿2

(
  # big ËË˜ & `Ë˜ tester
  _basicArgs â† { Test _ğ•£ ranks:
    {ğ•Šf: {{! f Test 0â€¿1â¥ŠËœ ğ•©âŠ0â€¿2â€¿4â€¿8â€¿32}Â¨ â†•ğ•©â¥Š3 â‹„ 1}Â¨ ranks}Â¨ +â€¿âˆ§â€¿âˆ¨â€¿=â€¿â‰ â€¿âŠ£â€¿âŠ¢
  }
  
  # TODO replace â—‹âŠ¢ with some pureness-preserving â€¢internal.Keep
  # w F _thing x tests F _thingâ‰w x
  _testFoldCells â† {âˆ¨Â´ğ•—=âŠ¢â€¿âŠ£? 0=Ã—Â´ğ•¨â†“â‰¢ğ•©? 1; (ğ”½Ëâ‰ğ•¨  â‰¡ ğ”½Ëâ—‹âŠ¢â‰ğ•¨)  ğ•©}
  _testScanCells â† {                      (ğ”½`â‰ğ•¨  â‰¡ ğ”½`â—‹âŠ¢â‰ğ•¨)  ğ•©}
  
  {1 ğ•¨ _testFoldCells ğ•©} _basicArgs 2â€¿3â€¿4
  {1 ğ•¨ _testScanCells ğ•©} _basicArgs 2â€¿3â€¿4
  {2 ğ•¨ _testScanCells ğ•©} _basicArgs 3â€¿4
  {2 ğ•¨ _testScanCells ğ•©} _basicArgs 3â€¿4
  
  
  âŸ¨0, 0â€¿1, 1â€¿0, 1, 10, 10â€¿1, 1â€¿10, 100âŸ© {
    ğ•¨â€¿ğ•© â¥ŠÂ¨â†©
    sh â† ğ•¨âˆ¾ğ•©
    cr â† â‰ ğ•©
    +â€¿âˆ§â€¿âˆ¨â€¿=â€¿â‰ â€¿âŠ£â€¿âŠ¢ {
      cr ğ• _testFoldCells ğ•©
      cr ğ• _testScanCells ğ•©
    }âŒœ {0=Ã—Â´sh? ğ•©; âˆ¾âŸ¨ğ•©, Â¬âŒ¾âŠ‘Â¨ ğ•©, Â¬âŒ¾(Â¯1âŠ‘â¥Š)Â¨ ğ•©âŸ©} shâŠ¸â¥ŠÂ¨ 0â€¿1
  }âŒœ âŸ¨0, 1, 2, 8, 8â€¿1, 4â€¿8, 4â€¿2, 59, 60, 63, 80, 81, 200âŸ©
)
