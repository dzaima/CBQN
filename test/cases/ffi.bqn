%DEF var Vâ†â€¢internal.Variation â‹„ LVâ†â€¢internal.ListVariations â‹„ CLRâ†â€¢internal.ClearRefs
%DEF tvar %USE var â‹„ _tvar â† {F _ğ•£ x: (CLR@) âŠ¢ {F ğ•© V x}Â¨ LV ğ•©; w F _ğ•£ x: (CLR@) âŠ¢ (LV ğ•¨) {(ğ•¨ V w) F ğ•© V x}âŒœ LV ğ•©}
%DEF defs size_t â† "u64" â‹„ size_tw â† 64


# bad â€¢FFI invocation
# generally weird
!"â€¢FFI: ğ•© must be a list" % @â€¢FFI @
!"â€¢FFI: ğ•© must be a list" % @â€¢FFI 2â€¿2â¥Š<"a"
!"â€¢FFI: Path must be a list of characters" % 1â€¿2 â€¢FFI ""â€¿"bqn_init"
!"Fnğ•©: This function can't be called monadically" % â€¢FFI ""â€¿"bqn_init"
@ â€¢FFIâŠ{ğ•Š: 28â†‘â€¢CurrentError@} ""â€¿"bqn_this symbol doesn't exist" %% "FFI: Failed to find symbol: "
!"FFIğ•©: Type must be a string" % @â€¢FFI "hello"
!"FFI: Too many arguments" % @â€¢FFI""â€¿"bqn_init"âˆ¾70000â¥Š<"i32"
!"Type parser: Unexpected character '?'" % @â€¢FFI""â€¿"bqn_init"â€¿"?"
!"Type parser: expected number" % @â€¢FFI""â€¿"bqn_init"â€¿"["
!"Type parser: Bad array type" % @â€¢FFI""â€¿"bqn_init"â€¿"[0"
!"Type parser: Unexpected end of input" % @â€¢FFI""â€¿"bqn_init"â€¿"[1]"
!"Type parser: expected number" % @â€¢FFI""â€¿"bqn_init"â€¿"[]i32"
!"Type parser: Unexpected end of input" % @â€¢FFI""â€¿"bqn_init"â€¿"{"
!"Type parser: expected number" % @â€¢FFI""â€¿"bqn_init"â€¿"i"
!"Type parser: Bad float width" % @â€¢FFI""â€¿"bqn_init"â€¿"f80"
!"Type parser: Bad float width" % @â€¢FFI""â€¿"bqn_init"â€¿"f128"
!"Type parser: Bad float width" % @â€¢FFI""â€¿"bqn_init"â€¿"f16"
!"Type parser: Bad float width" % @â€¢FFI""â€¿"bqn_init"â€¿"f1"
!"Type parser: Bad integer width" % @â€¢FFI""â€¿"bqn_init"â€¿"u1"
!"Type parser: Bad integer width" % @â€¢FFI""â€¿"bqn_init"â€¿"i0"
!"Type parser: Bad integer width" % @â€¢FFI""â€¿"bqn_init"â€¿"i10"
!"Type parser: Bad integer width" % @â€¢FFI""â€¿"bqn_init"â€¿"u128"
!"Type parser: Type was empty" % @â€¢FFI""â€¿"bqn_init"â€¿""
!"Type parser: number literal too large" % @â€¢FFI""â€¿"bqn_init"â€¿"u99999999999999"

# >/ğ•¨/ğ•©
!"FFI: Multiple occurrences of '>' within one argument" % @â€¢FFI""â€¿"bqn_init"â€¿">>i32"
!"FFI: Multiple occurrences of argument side specified" % @â€¢FFI""â€¿"bqn_init"â€¿"ğ•¨ğ•¨i32"
!"FFI: Multiple occurrences of argument side specified" % @â€¢FFI""â€¿"bqn_init"â€¿"ğ•©ğ•©i32"
!"FFI: Multiple occurrences of argument side specified" % @â€¢FFI""â€¿"bqn_init"â€¿"ğ•¨ğ•©i32"
!"FFI: Multiple arguments on ğ•© specified, some with '>'" % @â€¢FFI""â€¿"bqn_init"â€¿">i32"â€¿">i32"
!"FFI: Multiple arguments on ğ•¨ specified, some with '>'" % @â€¢FFI""â€¿"bqn_init"â€¿">ğ•¨i32"â€¿">ğ•¨i32"
!"FFI: Multiple arguments on ğ•© specified, some with '>'" % @â€¢FFI""â€¿"bqn_init"â€¿">i32"â€¿"i32"
!"FFI: Multiple arguments on ğ•¨ specified, some with '>'" % @â€¢FFI""â€¿"bqn_init"â€¿">ğ•¨i32"â€¿"ğ•¨i32"

# arrays
!"Type parser: 0-item arrays not supported" % @â€¢FFI""â€¿"bqn_init"â€¿"[0]i32"
!"Type parser: number literal too large" % @â€¢FFI""â€¿"bqn_init"â€¿"[999999999999]i32"
!"FFI: Cannot return array" % @â€¢FFI"[4]i32"â€¿"bqn_init"

# structs
!"Type parser: Improper struct separator or end" % @â€¢FFI""â€¿"bqn_init"â€¿"{*i32*i32}"
!"Type parser: Improper struct separator or end" % @â€¢FFI""â€¿"bqn_init"â€¿"{*i32"
!"Type parser: Unexpected end of input" % @â€¢FFI""â€¿"bqn_init"â€¿"{*i32,"
!"Type parser: '&' currently can only be used as the outermost type" % @â€¢FFI""â€¿"bqn_init"â€¿"{&i32}"
!"Type parser: '&' currently can only be used as the outermost type" % @â€¢FFI""â€¿"bqn_init"â€¿"{[2]&i32}"

# :
!"Type parser: expected number" % @â€¢FFI""â€¿"bqn_init"â€¿"i32:"
!"Type parser: Unexpected character after "":""" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*u64:q8"
!"Type parser: expected number" % @â€¢FFI""â€¿"bqn_init"â€¿"i32:i"
!"Type parser: Unsupported width in :i9" % @â€¢FFI""â€¿"bqn_init"â€¿"i32:i9"
!"Type parser: Unsupported width in :u16" % @â€¢FFI""â€¿"bqn_init"â€¿"i32:u16"
!"Type parser: Unsupported width in :i64" % @â€¢FFI"i32:i64"â€¿"bqn_init"
!"Type parser: Unsupported width in :f32" % @â€¢FFI""â€¿"bqn_init"â€¿"i32:f32"
!"Type parser: number literal too large" % @â€¢FFI""â€¿"bqn_init"â€¿"i32:u9999999999999999"
!"Type parser: Representation wider than the value within" % @â€¢FFI""â€¿"bqn_init"â€¿"i32:f64"
!"Type parser: Garbage at end of type" % @â€¢FFI""â€¿"bqn_init"â€¿"i32 hello world"

# pointers
!"Type parser: Unexpected end of input" % @â€¢FFI""â€¿"bqn_init"â€¿"&"
!"Type parser: '&' currently can only be used as the outermost type" % @â€¢FFI""â€¿"bqn_init"â€¿"{&}"
!"Type parser: Unexpected character ':'" % @â€¢FFI""â€¿"bqn_init"â€¿"&:i8"

# return value
!"FFI: Function specification must have at least two items" % @â€¢FFI âŸ¨"&"âŸ©
!"FFI: Return value is specified as ""&"", but there are 0 mutated values" % @â€¢FFI"&"â€¿"bqn_init"â€¿">*i32"
!"FFI: Return value is specified as ""&"", but there are 2 mutated values" % @â€¢FFI"&"â€¿"bqn_init"â€¿"&i32"â€¿"&i32"
!"FFI: Cannot return array" % @â€¢FFI"[4]i32"â€¿"bqn_init"
!"FFI: Unimplemented result type" % @â€¢FFI"**:i8"â€¿"bqn_init"
!"FFI: Result type cannot be mutated" % @â€¢FFI"&i32"â€¿"bqn_init"


# correct elements
%USE defs â‹„ fâ†@â€¢FFI"&"â€¿"memcpy"â€¿"&u8"â€¿"*i8"â€¿size_t â‹„ Gâ†{FâŸ¨ğ•©,â†•0,0âŸ©} â‹„ %USE tvar â‹„ !âˆ˜â‰¡Â¨âŸœâŠ G _tvar 100â¥Š1â€¿0
%USE defs â‹„ fâ†@â€¢FFI"&"â€¿"memcpy"â€¿"&u8"â€¿"*i8"â€¿size_t â‹„ Gâ†{FâŸ¨ğ•©,â†•0,0âŸ©} â‹„ G â†•200 %% â†•200
%USE defs â‹„ fâ†@â€¢FFI"&"â€¿"memcpy"â€¿"&u16"â€¿"*i8"â€¿size_t â‹„ Gâ†{FâŸ¨ğ•©,â†•0,0âŸ©} â‹„ G â‹ˆ65535 %% â‹ˆ65535
%USE defs â‹„ fâ†@â€¢FFI"&"â€¿"memcpy"â€¿"&u32"â€¿"*i8"â€¿size_t â‹„ Gâ†{FâŸ¨ğ•©,â†•0,0âŸ©} â‹„ G (2â‹†32)|Â¯5+â†•10 %% (2â‹†32)|Â¯5+â†•10
%USE defs â‹„ fâ†@â€¢FFI"&"â€¿"memcpy"â€¿"&i16"â€¿"*i8"â€¿size_t â‹„ Gâ†{FâŸ¨ğ•©,â†•0,0âŸ©} â‹„ G Â¯32768â€¿32767 %% Â¯32768â€¿32767
%USE defs â‹„ fâ†@â€¢FFI"&"â€¿"memcpy"â€¿"&{i16}"â€¿"*i8"â€¿size_t â‹„ Gâ†{FâŸ¨ğ•©,â†•0,0âŸ©} â‹„ G â‹ˆÂ¨Â¯32768â€¿32767 %% â‹ˆÂ¨Â¯32768â€¿32767
%USE defs â‹„ fâ†@â€¢FFI"&"â€¿"memcpy"â€¿"&f32"â€¿"*i8"â€¿size_t â‹„ Gâ†{FâŸ¨ğ•©,â†•0,0âŸ©} â‹„ G âŸ¨âˆ,Â¯âˆ,âˆÃ·âˆâŸ©âˆ¾10Ã·Ëœâ†•10 %% âŸ¨âˆ,Â¯âˆ,âˆÃ·âˆâŸ©âˆ¾0â€¿0.10000000149011612â€¿0.20000000298023224â€¿0.30000001192092896â€¿0.4000000059604645â€¿0.5â€¿0.6000000238418579â€¿0.699999988079071â€¿0.800000011920929â€¿0.8999999761581421
%USE defs â‹„ fâ†@â€¢FFI"&"â€¿"memcpy"â€¿"&i32"â€¿"*i16:u1"â€¿size_t â‹„ F âŸ¨â‹ˆ5, 32â¥Š1, 4âŸ© %% â‹ˆÂ¯1
%USE defs â‹„ fâ†@â€¢FFIâŸ¨"&","memcpy","&i8","*i8",size_tâˆ¾":u1"âŸ© â‹„ F âŸ¨Â¯100+â†•10, â†•10, size_twâ†‘0â€¿0â€¿1âŸ© %% (â†•4)âˆ¾4â†“Â¯100+â†•10
%USE defs â‹„ fâ†@â€¢FFI"&"â€¿"memcpy"â€¿"&i16"â€¿"*i16:i32"â€¿size_t â‹„ F âŸ¨Â¯100+â†•10, âŸ¨123+456Ã—2â‹†16, Â¯2âŸ©, 8âŸ© %% 123â€¿456â€¿Â¯2â€¿Â¯1âˆ¾4â†“Â¯100+â†•10
%USE defs â‹„ fâ†@â€¢FFIâŸ¨size_t,"strlen","*i8"âŸ© â‹„ âŸ¨âŸ© F â‹ˆ1â€¿2â€¿3â€¿0 %% 3
%USE defs â‹„ fâ†@â€¢FFIâŸ¨"&","memcpy","&i8","[4]i8",size_tâŸ© â‹„ F âŸ¨10â¥Š0, 3+â†•4, 4âŸ© %% 3â€¿4â€¿5â€¿6â€¿0â€¿0â€¿0â€¿0â€¿0â€¿0


# bad array elements
!"Type parser: '&' currently can only be used as the outermost type" % %USE defs â‹„ fâ†@â€¢FFI"&"â€¿"memcpy"â€¿"&{&i16}"â€¿"*i8"â€¿size_t â‹„ Gâ†{FâŸ¨ğ•©,â†•0,0âŸ©} â‹„ G â‹ˆâˆ˜â‹ˆÂ¨Â¯32768â€¿32767

!"FFI: Array provided for &u8 contained 299" % fâ†@â€¢FFI"&"â€¿"bqn_init"â€¿">&u8" â‹„ F â†•300
!"FFI: Array provided for &u8 contained Â¯99" % fâ†@â€¢FFI"&"â€¿"bqn_init"â€¿">&u8" â‹„ F -â†•100
!"FFI: Array provided for &u16 contained 65536" % fâ†@â€¢FFI"&"â€¿"bqn_init"â€¿">&u16" â‹„ F â‹ˆ65536
!"FFI: Array provided for &u32 contained 4294967296" % fâ†@â€¢FFI"&"â€¿"bqn_init"â€¿">&u32" â‹„ F â‹ˆ2â‹†32
!"FFI: Array provided for &u16 contained Â¯1" % fâ†@â€¢FFI"&"â€¿"bqn_init"â€¿">&u16" â‹„ F â‹ˆÂ¯1
!"FFI: Array provided for &u32 contained Â¯1" % fâ†@â€¢FFI"&"â€¿"bqn_init"â€¿">&u32" â‹„ F â‹ˆÂ¯1

# bad scalars
!"FFI: improper value for u8" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">u8" â‹„ F 256
!"FFI: improper value for u16" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">u16" â‹„ F Â¯1
!"FFI: improper value for u32" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">u32" â‹„ F Â¯1
!"FFI: improper value for u64" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">u64" â‹„ F Â¯1
!"FFI: improper value for u32" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">u32" â‹„ F 2â‹†32
!"FFI: improper value for u32" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">u32" â‹„ F 1e20
!"FFI: u64 argument value â‰¥ 2â‹†53" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">u64" â‹„ F 2â‹†53
!"FFI: i64 argument absolute value â‰¥ 2â‹†53" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">i64" â‹„ F 2â‹†53
!"FFI: i64 argument absolute value â‰¥ 2â‹†53" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">i64" â‹„ F -2â‹†53
!"FFI: improper value for i32" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">ğ•¨i32"â€¿">i64" â‹„ @ F 3
!"FFI: improper value for i32" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">ğ•¨i32"â€¿">i64" â‹„ âŸ¨1âŸ© F 3
!"FFI: improper value for i64" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿"i64" â‹„ F âŸ¨@âŸ©


# bad overall argument separation
!"FFI: Expected list ğ•©" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿"i32"â€¿"i32" â‹„ F @
!"FFI: Expected list ğ•©" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿"i32"â€¿"i32" â‹„ F â‰âŸ¨â†•2, â†•2âŸ©
!"FFI: Expected list ğ•¨" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿"ğ•¨i32"â€¿"ğ•¨i32" â‹„ (â‰1â€¿2) F âŸ¨âŸ©
!"FFI: Wrong argument count in ğ•©: expected 2, got 3" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿"i32"â€¿"i32" â‹„ F âŸ¨â†•2, â†•2, â†•2âŸ©
!"FFI: Wrong argument count in ğ•©: expected 2, got 1" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿"i32"â€¿"i32" â‹„ F âŸ¨â†•2âŸ©
!"FFI: Wrong argument count in ğ•¨: expected 2, got 3" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿"i32"â€¿"ğ•¨i32"â€¿"ğ•¨i32" â‹„ âŸ¨â†•2, â†•2, â†•2âŸ© F âŸ¨4âŸ©
!"FFI: ğ•© must be an empty list" % fâ†@â€¢FFI""â€¿"bqn_init" â‹„ F âŸ¨1âŸ©
!"FFI: ğ•© must be an empty list" % fâ†@â€¢FFI""â€¿"bqn_init" â‹„ F @
!"FFI: ğ•© must be an empty list" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿"ğ•¨i32"â€¿"ğ•¨i32" â‹„ 1â€¿2 F @
!"FFI: ğ•¨ must either be an empty list, or not be present" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿"*i8" â‹„ âŸ¨1,2âŸ© F 1â€¿2â€¿3â€¿0
!"FFI: ğ•¨ must either be an empty list, or not be present" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿"*i8" â‹„ @ F 1â€¿2â€¿3â€¿0
!"FFI: ğ•¨ must be present" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿"ğ•¨i32"â€¿"ğ•¨i32" â‹„ F âŸ¨âŸ©
!"FFI: ğ•¨ must be present" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿"ğ•¨i32"â€¿"i32" â‹„ F âŸ¨3âŸ©
!"FFI: ğ•¨ must be present" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">ğ•¨i32"â€¿">i32" â‹„ F 3



# wrong argument internal structure
!"FFI: Expected array or pointer object corresponding to ""*[2]i32""" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*[2]i32" â‹„ F @
!"FFI: Expected array or pointer object corresponding to ""*{...}""" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*{i32}" â‹„ F @
!"FFI: Expected array corresponding to ""{...}""" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">{i32}" â‹„ F 0
!"FFI: Expected array corresponding to ""{...}""" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*{i32}" â‹„ F âŸ¨0âŸ©
!"FFI: Expected array corresponding to ""[1]i32""" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*[1]i32" â‹„ F âŸ¨0âŸ©
!"FFI: Incorrect list length corresponding to a struct: expected 1, got 0" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*{i32}" â‹„ F âŸ¨âŸ¨âŸ©âŸ©
!"FFI: Incorrect list length corresponding to a struct: expected 1, got 2" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*{i32}" â‹„ F âŸ¨1â€¿2âŸ©
!"FFI: Incorrect list length corresponding to an array: expected 2, got 0" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*[2]i32" â‹„ F âŸ¨âŸ¨âŸ©âŸ©
!"FFI: Incorrect list length corresponding to an array: expected 2, got 3" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*[2]i32" â‹„ F âŸ¨1â€¿2â€¿3âŸ©

# bad :
!"FFI: Expected array corresponding to ""i32:i8""" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">i32:i8" â‹„ F @
!"FFI: Expected array or pointer object corresponding to ""*i32:i8""" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*i32:i8" â‹„ F @

!"FFI: Bad array corresponding to ""i32:i8"": expected 4 elements, got 10" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">i32:i8" â‹„ F â†•10
!"FFI: Bad array corresponding to ""u64:u1"": expected 64 elements, got 128" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">u64:u1" â‹„ F 128â¥Š1

!"FFI: Array provided for :u1 contained 63" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">u64:u1" â‹„ F â†•64
!"FFI: Bad array corresponding to ""u64:i8"": expected 8 elements, got 64" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">u64:i8" â‹„ F â†•64

!"FFI: Expected array or pointer object corresponding to ""*u64:i8""" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*u64:i8" â‹„ F @
!"FFI: Array provided for :i8 contained 199" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*u64:i8" â‹„ F â†•200
!"FFI: Array provided for :i8 contained 199" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">&u64:i8" â‹„ F â†•200
!"FFI: Array provided for :u1 contained 63" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">&u64:u1" â‹„ F â†•64
!"FFI: Bad array corresponding to ""*u64:i8"": expected a multiple of 8 elements, got 2" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*u64:i8" â‹„ F â†•2
!"FFI: Bad array corresponding to ""*u32:i16"": expected a multiple of 2 elements, got 1" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*u32:i16" â‹„ F â†•1
!"FFI: Bad array corresponding to ""&u64:u1"": expected a multiple of 64 elements, got 32" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">&u64:u1" â‹„ F 32â¥Š0

!"FFI: Array provided for &i16 contained 32768" % fâ†@â€¢FFI"&"â€¿"bqn_init"â€¿">&i16" â‹„ F Â¯32768â€¿32768
!"FFI: Array provided for &i16 contained Â¯32769" % fâ†@â€¢FFI"&"â€¿"bqn_init"â€¿">&i16" â‹„ F Â¯32768â€¿Â¯32769

!"FFI: Array provided for &u8 contained array" % fâ†@â€¢FFI"&"â€¿"bqn_init"â€¿">&u8" â‹„ F âŸ¨â†•300âŸ©
!"FFI: Array provided for &i16 contained character" % fâ†@â€¢FFI"&"â€¿"bqn_init"â€¿">&i16" â‹„ F "hi"
!"FFI: Array provided for &f64 contained namespace" % fâ†@â€¢FFI"&"â€¿"bqn_init"â€¿">&f64" â‹„ F 1â€¿2â€¿{â‡}

!"FFI: Array provided for :c8 contained array" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*i8:c8" â‹„ F â‹ˆ"hello"
!"FFI: Expected array or pointer object corresponding to ""*i8:c8""" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*i8:c8" â‹„ F 4
!"FFI: Array provided for :c8 contained number" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*i8:c8" â‹„ F â‹ˆ4
!"FFI: Array provided for :c8 contained number" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*i8:c8" â‹„ F "Ah"â€¢internal.Variationâ‹ˆ4

!"FFI: improper value for i8" %                                    fâ†@â€¢FFI""â€¿"bqn_init"â€¿"*i8:c8"  â€¿"i8" â‹„ F "hello"â€¿1000
!"FFI: Array provided for :c8 contained object of unknown type" %  fâ†@â€¢FFI""â€¿"bqn_init"â€¿"*i8:c8"  â€¿"i8" â‹„ F "hello â‰"â€¿1000
!"FFI: Array provided for :c8 contained object of unknown type" %  fâ†@â€¢FFI""â€¿"bqn_init"â€¿"*i8:c8"  â€¿"i8" â‹„ F "hello ğ•©"â€¿1000
!"FFI: improper value for i8" %                                    fâ†@â€¢FFI""â€¿"bqn_init"â€¿"*i16:c16"â€¿"i8" â‹„ F "hello"â€¿1000
!"FFI: improper value for i8" %                                    fâ†@â€¢FFI""â€¿"bqn_init"â€¿"*i16:c16"â€¿"i8" â‹„ F "hello â‰"â€¿1000
!"FFI: Array provided for :c16 contained object of unknown type" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿"*i16:c16"â€¿"i8" â‹„ F "hello ğ•©"â€¿1000
!"FFI: improper value for i8" %                                    fâ†@â€¢FFI""â€¿"bqn_init"â€¿"*i32:c32"â€¿"i8" â‹„ F "hello"â€¿1000
!"FFI: improper value for i8" %                                    fâ†@â€¢FFI""â€¿"bqn_init"â€¿"*i32:c32"â€¿"i8" â‹„ F "hello â‰"â€¿1000
!"FFI: improper value for i8" %                                    fâ†@â€¢FFI""â€¿"bqn_init"â€¿"*i32:c32"â€¿"i8" â‹„ F "hello ğ•©"â€¿1000

%USE defs â‹„ fâ†@â€¢FFI"*"â€¿"memcpy"â€¿"&i8"â€¿"*i8:c8"â€¿size_t â‹„ 1âŠ‘F âŸ¨â†•5, "Ah"â€¢internal.Variation"hello", 5âŸ© %% 104â€¿101â€¿108â€¿108â€¿111



# unimplemented stuff
!"FFI: Unimplemented pointer element type within ""&i64""" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">&i64" â‹„ F â†•10
!"FFI: Unimplemented pointer element type within ""*i64""" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">*i64" â‹„ F â†•10
!"FFI: Unimplemented pointer element type within ""&u64""" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">&u64" â‹„ F â†•10
!"FFI: Pointer element type not implemented" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">**u64" â‹„ F âŸ¨â†•2âŸ©



# pointer objects
%DEF mm %USE defs â‹„ Calloc â† {1â€¿ğ•© {ğ•ğ•¨} @â€¢FFIâŸ¨"*"âˆ¾ğ•¨, "calloc", size_t, size_tâŸ©} â‹„ free â† @â€¢FFI""â€¿"free"â€¿">*" â‹„ cpy â† @â€¢FFI"*:i8"â€¿"memcpy"â€¿"*"â€¿"*"â€¿size_t â‹„ CpyA â† +Â´(2â‹†8Ã—â†•8)Ã—256|Cpy
%DEF WallocE %USE mm â‹„ {allocsâ†âŸ¨âŸ© â‹„ Cleanâ†{FreeÂ¨allocsâ‹„ğ•©} â‹„ Clean ğ•âŠ{ğ•Š: !â€¢CurrentError Clean @} {{r âŠ£ allocsâˆ¾â†© râ† ğ•¨ Calloc ğ•©}}}
%DEF Walloc  %USE mm â‹„ {allocsâ†âŸ¨âŸ© â‹„ Cleanâ†{FreeÂ¨allocsâ‹„ğ•©} â‹„ Clean ğ•                             {{r âŠ£ allocsâˆ¾â†© râ† ğ•¨ Calloc ğ•©}}}

# .Field
%USE Walloc {{ğ•Šal: 1âˆ˜("{i32,i32,i32}" Al 99).FieldâŠ0Â¨ Â¯2+â†•8}} %% 0â€¿0â€¿1â€¿1â€¿1â€¿0â€¿0â€¿0
%USE Walloc {{ğ•Šal: 1âˆ˜("[5]u8"         Al 99).FieldâŠ0Â¨ Â¯2+â†•9}} %% 0â€¿0â€¿1â€¿1â€¿1â€¿1â€¿1â€¿0â€¿0
%USE Walloc {{ğ•Šal: 1âˆ˜("[5]u8"         Al 99).FieldâŠ0Â¨ âŸ¨âˆ,Â¯âˆ,0Ã·0,@,"foo",{â‡}âŸ©}} %% 6â¥Š0

# .Write, .Read
%USE Walloc {{ğ•Šal: pâ†"{i16,i16,i16,i64}" Al 99 â‹„ p.Write Â¯4â€¿10000â€¿Â¯30000â€¿7e12 â‹„ sâ†-â—‹{CpyA 0âˆ¾Ëœâ‹ˆËœğ•©}Â´ âŸ¨p.Field 2, pâŸ© â‹„ Cpy âŸ¨p.Add 1, p, sâŸ© â‹„ p.ReadÂ¨ â†•2}} %% âŸ¨Â¯4â€¿10000â€¿Â¯30000â€¿7e12, Â¯4â€¿10000â€¿0â€¿0âŸ©
%USE Walloc {{ğ•Šal: pâ†"{i32,{i64,i64}}" Al 999 â‹„ {ğ•© p.Write âŸ¨ğ•©Ã—10,ğ•©Ã—20â€¿30âŸ©}Â¨ â†•4 â‹„ ((p.Field 1).Field 0).ReadÂ¨ â†•4 }} %% 20Ã—â†•4
!"Cannot get a field of a pointer to a scalar" % %USE WallocE {{ğ•Šal: ("i32" Al 99).Field 0}}
!"ptr.Write: Cannot write array to ""*i32""" % %USE WallocE {{ğ•Šal: ("*i32" Al 99).Write 1â€¿2â€¿3}}
!"ptr.Write: Cannot write array to ""*i32:i32""" % %USE WallocE {{ğ•Šal: ("*i32:i32"Al 99).Write â†•16}}
!"FFI: Cannot read from ""*i32:i32""" % %USE WallocE {{ğ•Šal: ("*i32:i32"Al 99).Read 0}}
%USE Walloc {{ğ•Šal: pâ†("" Al 99).Cast "*:i8" â‹„ aâ†"i32"Al 99 â‹„ a.Write 12345 â‹„ p.Write arâ†Cpy aâ€¿aâ€¿0 â‹„ ! ar â‰¡ p.Read 0 â‹„ a.Read 0}} %% 12345
%USE Walloc {{ğ•Šal: pâ†"i16" Al 99 â‹„ raw â† Cpy 0âˆ¾Ëœâ‹ˆËœp.Add 3 â‹„ cpy2â†@â€¢FFI"*i16"â€¿"memcpy"â€¿"*:i8"â€¿"*:i8"â€¿size_t â‹„ p.Sub Cpy2 rawâ€¿rawâ€¿0 }} %% Â¯3

# garbage arguments
!"Expected integer, got character" % %USE WallocE {{ğ•Šal: pâ†"i8" Al 1 â‹„ p.Add '!'}}
!"(pointer).Sub: Unexpected argument type: character" % %USE WallocE {{ğ•Šal: pâ†"i8" Al 1 â‹„ p.Sub '!'}}
!"Expected non-negative integer, got character" % %USE WallocE {{ğ•Šal: pâ†"i8" Al 1 â‹„ p.Field '!'}}
!"Type parserğ•©: Pointer type must be a string" % %USE WallocE {{ğ•Šal: pâ†"i8" Al 1 â‹„ p.Cast '!'}}
!"Expected integer, got character" % %USE WallocE {{ğ•Šal: pâ†"i8" Al 1 â‹„ p.Read '!'}}
!"FFI: improper value for i8" % %USE WallocE {{ğ•Šal: pâ†"i8" Al 1 â‹„ p.Write '!'}}

# untyped pointers
!"Cannot get a field of a pointer to a scalar" % %USE WallocE {{ğ•Šal: ("" Al 99).Field 0}}
# %USE Walloc {{ğ•Šal: pâ†"i32" Al 99 â‹„ p.Write 123 â‹„ (((p.Cast "").Add 0).Cast"i32").Read 0}} %% 123
!"Cannot offset an untyped pointer" % %USE WallocE {{ğ•Šal: ("" Al 99).Add 0}}
!"Cannot offset an untyped pointer" % %USE WallocE {{ğ•Šal: ("" Al 99).Add 1}}

# .Add, .Sub, .Cast
!"Type parser: Unexpected end of input" % %USE WallocE {{ğ•Šal: pâ†"{i32,*}" Al 1 â‹„ p.Cast "{"}}
%USE Walloc {{ğ•Šal: pâ†"{i32,*}" Al 1 â‹„ p.Sub p.Cast "{i32,*i32}"}} %% 0
%USE Walloc {{ğ•Šal: pâ†"{i32,*}" Al 1 â‹„ p.Sub p.Add 123}} %% Â¯123
%USE Walloc {{ğ•Šal: pâ†"{i32,*}" Al 1 â‹„ p.Sub p.Sub 123}} %% 123

# ptr1.Sub ptr2
!"(pointer).Sub ptr: Both pointers must be typed" % %USE WallocE {{ğ•Šal: pâ†"" Al 1 â‹„ p.Sub p}}
!"(pointer).Sub ptr: Both pointers must be typed" % %USE WallocE {{ğ•Šal: pâ†"i8" Al 1 â‹„ (p.Cast "").Sub p.Cast "{{i8,i16},i32}"}}
!"(pointer).Sub ptr: Both pointers must be typed" % %USE WallocE {{ğ•Šal: pâ†"i8" Al 1 â‹„ (p.Cast "{{i8,i16},i32}").Sub p.Cast ""}}
!"(pointer).Sub ptr: Arguments must have the same stride" % %USE WallocE {{ğ•Šal: pâ†"i8" Al 1 â‹„ ((p.Cast "{{i8,i16},i32}").Field 0).Sub p.Cast "{i8,i16}"}}
!"(pointer).Sub ptr: Arguments must have compatible types" % %USE WallocE {{ğ•Šal: pâ†"i8" Al 1 â‹„ p.Sub p.Cast "u8"}}
!"(pointer).Sub ptr: Distance between pointers isn't an exact multiple of stride" % %USE WallocE {{ğ•Šal: pâ†"i8" Al 1 â‹„ (p.Cast "i32").Sub (p.Add 6).Cast "i32"}}
!"Type parser: '&' currently can only be used as the outermost type" % @â€¢FFI ""â€¿"bqn_init"â€¿"{&i8}"

# type comparison
%USE Walloc {{ğ•Šal: pâ†"i8" Al 1 â‹„ tâ†"{{i8,i16,**i8,[12]i8,*:i32,i64:f64,*,*f64},i32,i64:c8}" â‹„ (p.Cast t).Sub p.Cast t}} %% 0 # âŠ-less test of most passing things to run under heapverify
%DEF TyEq {expğ•Šaâ€¿b: %USE Walloc {{ğ•Šal: pâ†"i8" Al 1 â‹„ ! (expâŠ‘99â€¿0) â‰¡ ((p.Cast a).Sub)âŠ99 p.Cast b}}}
1 %USE TyEq âŸ¨"{*i16}", "{*i16}"âŸ©
0 %USE TyEq âŸ¨"{*i16}", "{*u16}"âŸ©
1 %USE TyEq âŸ¨"{*i16}", "{*}"âŸ©
1 %USE TyEq âŸ¨"{*}",    "{*i16}"âŸ©
1 %USE TyEq âŸ¨"{*:i8}", "{*i16}"âŸ©
1 %USE TyEq âŸ¨"{*:i8}", "{*i16:i8}"âŸ©
1 %USE TyEq âŸ¨"{*:i8}", "{*i16:i32}"âŸ©

1 %USE TyEq âŸ¨"{{i8,i16},i32}", "{{i8,i16},i32}"âŸ©
0 %USE TyEq âŸ¨"{{i8,i16},i32}", "{{u8,i16},i32}"âŸ©
1 %USE TyEq âŸ¨"{[3]i32,[5]i32}", "{[3]i32,[5]i32}"âŸ©
1 %USE TyEq âŸ¨"{[3]i32,[5]i32}", "{[3]i32,[5]i32:i8}"âŸ©
0 %USE TyEq âŸ¨"{[3]i32,[5]i32}", "{[3]i32,[5]u32}"âŸ©
0 %USE TyEq âŸ¨"{[3]i32,[5]i32}", "{[5]i32,[3]i32}"âŸ©
0 %USE TyEq âŸ¨"[4]i32", "[3]i32"âŸ©
0 %USE TyEq âŸ¨"*[4]i32", "*[3]i32"âŸ©
0 %USE TyEq âŸ¨"{i32}", "i32"âŸ©
0 %USE TyEq âŸ¨"i16", "i32"âŸ©
0 %USE TyEq âŸ¨"i16", "u16"âŸ©
1 %USE TyEq âŸ¨"{i32:i8,i64}", "{i32:i8,i64}"âŸ©
0 %USE TyEq âŸ¨"{i32:i8,i64}", "{u32:i8,i64}"âŸ©
0 %USE TyEq âŸ¨"{i32:i8,i64}", "{i16:i8,i64}"âŸ©
0 %USE TyEq âŸ¨"*{i32:i8}", "*{i16:i8}"âŸ©
1 %USE TyEq âŸ¨"{i32:i8,i64}", "{i32:i16,i64}"âŸ©
1 %USE TyEq âŸ¨"{i32:i32,i64}","{i32:u1,i64}"âŸ©
1 %USE TyEq âŸ¨"{i32:i8,i64}", "{i32,i64}"âŸ©
1 %USE TyEq âŸ¨"*i32:i8", "*"âŸ©
1 %USE TyEq âŸ¨"*i32:i8", "*:c32"âŸ©
1 %USE TyEq âŸ¨"*i32", "*:c32"âŸ©
0 %USE TyEq âŸ¨"**", "*i8"âŸ©
0 %USE TyEq âŸ¨"*{*:i8}", "*{i8}"âŸ©
0 %USE TyEq âŸ¨"*{*}", "*{i8}"âŸ©
0 %USE TyEq âŸ¨"*{i8}", "*{*}"âŸ©

# passing pointer objects as arguments
!"FFI: Pointer object type isn't compatible with argument type" % %USE WallocE {{ğ•Šal: f â† @â€¢FFI""â€¿"bqn_init"â€¿">*i8" â‹„ pâ†"i16" Al 10 â‹„ F p}}
%USE Walloc {{ğ•Šal: p â† "i16" Al 99 â‹„ p.WriteÂ¨Ëœ â†•10 â‹„ a â† (p.Add 10).Cast"i16:c8" â‹„ fâ†@â€¢FFI"*:i8"â€¿"memcpy"â€¿"&i16:c8"â€¿"*i16:c8"â€¿size_t â‹„ ! a â‰¡ 1âŠ‘F âŸ¨a, p.Cast"", 8âŸ© â‹„ p.ReadÂ¨ â†•20}} %% âˆ¾âŸ¨â†•10, â†•4, 6â¥Š0âŸ©
%USE Walloc {{ğ•Šal: p â† "i16" Al 99 â‹„ p.WriteÂ¨Ëœ â†•10 â‹„ Cpy âŸ¨(p.Add 10).Cast"i16:c8", p.Cast"", 8âŸ© â‹„ p.ReadÂ¨ â†•20}} %% âˆ¾âŸ¨â†•10, â†•4, 6â¥Š0âŸ©
%USE Walloc {{ğ•Šal: p â† "i16" Al 99 â‹„ p.WriteÂ¨Ëœ â†•10 â‹„ a â† (p.Add 10).Cast"i16:c8" â‹„ fâ†@â€¢FFI"*:i8"â€¿"memcpy"â€¿"&i16"   â€¿"*:i8"   â€¿size_t â‹„ ! a â‰¡ 1âŠ‘F âŸ¨a, p.Cast"", 8âŸ© â‹„ p.ReadÂ¨ â†•20}} %% âˆ¾âŸ¨â†•10, â†•4, 6â¥Š0âŸ©

# unchecked stuff
# !"FFI: Bad array corresponding to ""i64:c8"": expected 8 elements, got 1" % fâ†@â€¢FFI""â€¿"bqn_init"â€¿">i64:c8" â‹„ F 8â¥Š2
