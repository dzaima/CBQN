%DEF var Vâ†â€¢internal.Variation â‹„ LVâ†â€¢internal.ListVariations â‹„ CLRâ†â€¢internal.ClearRefs
%DEF tvar %USE var â‹„ _tvar â† {F _ğ•£ x: (CLR@) âŠ¢ {F ğ•© V x}Â¨ LV ğ•©; w F _ğ•£ x: (CLR@) âŠ¢ (LV ğ•¨) {(ğ•¨ V w) F ğ•© V x}âŒœ LV ğ•©}
%DEF fastone (
  _fastone â† { F _ğ•£ ğ•©:
    t â† 0
    n â† ğ•©
    @âˆ˜FÂ¨ â†•n
    { ğ•Š:
      c â† Fâ€¢_timed @
      "wasn't fast enough" ! (n<10) âˆ¨ t<5
      t+â†© c
      n+â†© 1
      câ‰¥10000eÂ¯9
    }â€¢_while_âŠ¢ 1
    n
  }
)

# in-place âŒ¾(nâŠ¸âŠ‘)
(
  %USE fastone
  { ğ•Š toâ€¿ti:
    aâ†bâ† toâ€¢internal.Variation 10â¥Š < tiâ€¢internal.Variation â†•1e6
    n â† {ğ•Š: a 10âŠ¸+âŒ¾(4âŠ¸âŠ‘)âŒ¾(1âŠ¸âŠ‘) â†©} _fastone 10
    ! (4+10Ã—n) â‰¡ 4âŠ‘1âŠ‘a
  }Â¨ âŸ¨"Ah"â€¿"Ai32", "Af"â€¿"Ai32", "Sh"â€¿"Ai32", "Sf"â€¿"Ai32", "Ah"â€¿"Ah"âŸ©
)

# in-place âŒ¾âŠ‘
%USE fastone â‹„ aâ†5+â†•1e6 â‹„ nâ†{ğ•Š: a 1âŠ¸+âŒ¾âŠ‘â†©}_fastone 4 â‹„ ! (10â†‘a) â‰¡ (5+n)âˆ¾6+â†•9

# in-place âŒ¾(lâŠ¸âŠ) list
%USE fastone â‹„ aâ†â‹ˆÂ¨5+â†•1e6       â‹„ nâ†{ğ•Š: a 1âŠ¸+âŒ¾(1â€¿3â€¿3â€¿Â¯1âŠ¸âŠ)â†©}_fastone 4 â‹„ ! (â‹ˆÂ¨5â€¿6â€¿7â€¿8â€¿9â€¿1000000â€¿1000001â€¿1000002â€¿1000003â€¿1000004+0â€¿nâ€¿0â€¿nâ€¿0â€¿0â€¿0â€¿0â€¿0â€¿n) â‰¡ (5â†‘a)âˆ¾Â¯5â†‘a %!DEBUG
%USE fastone â‹„ aâ†5+â†•1e6         â‹„ nâ†{ğ•Š: a 1âŠ¸+âŒ¾(1â€¿3â€¿3â€¿Â¯1âŠ¸âŠ)â†©}_fastone 4 â‹„ ! (  5â€¿6â€¿7â€¿8â€¿9â€¿1000000â€¿1000001â€¿1000002â€¿1000003â€¿1000004+0â€¿nâ€¿0â€¿nâ€¿0â€¿0â€¿0â€¿0â€¿0â€¿n) â‰¡ (5â†‘a)âˆ¾Â¯5â†‘a %!DEBUG
%USE fastone â‹„ aâ†5+1e6â¥Š@+â†•10000 â‹„ nâ†{ğ•Š: a 1âŠ¸+âŒ¾(1â€¿3â€¿3â€¿Â¯1âŠ¸âŠ)â†©}_fastone 4 â‹„ ! (@+5â€¿6â€¿7â€¿8â€¿9â€¿10000â€¿10001â€¿10002â€¿10003â€¿10004          +0â€¿nâ€¿0â€¿nâ€¿0â€¿0â€¿0â€¿0â€¿0â€¿n) â‰¡ (5â†‘a)âˆ¾Â¯5â†‘a %!DEBUG
%USE fastone â‹„ aâ†5+1e6â¥Š@+â†•10000 â‹„ nâ†{ğ•Š: a'?'Â¨âŒ¾(1â€¿3â€¿3â€¿Â¯1âŠ¸âŠ)â†©}_fastone 4 â‹„ ! (@+5â€¿6â€¿7â€¿8â€¿9â€¿10000â€¿10001â€¿10002â€¿10003â€¿10004{ğ•©?63;  ğ•¨}Â¨0â€¿1â€¿0â€¿1â€¿0â€¿0â€¿0â€¿0â€¿0â€¿1) â‰¡ (5â†‘a)âˆ¾Â¯5â†‘a %!DEBUG
%USE fastone â‹„ aâ†5+1e6â¥Š@+â†•10000 â‹„ nâ†{ğ•Š: a 99Â¨âŒ¾(1â€¿3â€¿3â€¿Â¯1âŠ¸âŠ)â†©}_fastone 4 â‹„ ! (  5â€¿6â€¿7â€¿8â€¿9â€¿10000â€¿10001â€¿10002â€¿10003â€¿10004{ğ•©?99;@+ğ•¨}Â¨0â€¿1â€¿0â€¿1â€¿0â€¿0â€¿0â€¿0â€¿0â€¿1) â‰¡ (5â†‘a)âˆ¾Â¯5â†‘a %!DEBUG

# in-place âŒ¾(lâŠ¸âŠ) highrank
%USE fastone â‹„ aâ†âˆ˜â€¿2â€¿2â¥Šâ‹ˆÂ¨5+â†•1e6       â‹„ nâ†{ğ•Š: a 1âŠ¸+âŒ¾(1â€¿3â€¿3â€¿Â¯1âŠ¸âŠ)â†©}_fastone 4 â‹„ ! a â‰¡ (nÃ—âŸ¨1,3,Â¯1+â‰ aâŸ©âˆŠËœâ†•â‰ a) + âˆ˜â€¿2â€¿2â¥Šâ‹ˆÂ¨5+â†•1e6       %!DEBUG
%USE fastone â‹„ aâ†âˆ˜â€¿2â€¿2â¥Š5+â†•1e6         â‹„ nâ†{ğ•Š: a 1âŠ¸+âŒ¾(1â€¿3â€¿3â€¿Â¯1âŠ¸âŠ)â†©}_fastone 4 â‹„ ! a â‰¡ (nÃ—âŸ¨1,3,Â¯1+â‰ aâŸ©âˆŠËœâ†•â‰ a) + âˆ˜â€¿2â€¿2â¥Š5+â†•1e6         %!DEBUG
%USE fastone â‹„ aâ†âˆ˜â€¿2â€¿2â¥Š5+1e6â¥Š@+â†•10000 â‹„ nâ†{ğ•Š: a 1âŠ¸+âŒ¾(1â€¿3â€¿3â€¿Â¯1âŠ¸âŠ)â†©}_fastone 4 â‹„ ! a â‰¡ (nÃ—âŸ¨1,3,Â¯1+â‰ aâŸ©âˆŠËœâ†•â‰ a) + âˆ˜â€¿2â€¿2â¥Š5+1e6â¥Š@+â†•10000 %!DEBUG

# in-place âˆ¾âŸœatom & âˆ¾âŸœlist
%USE fastone â‹„ %USE tvar â‹„ LVâ†©"f"âŠ¸LV â‹„ {ğ•Šv: jâ†<âŸ(Ã—â‰¡) v â‹„ {aâ†ğ•© â‹„ nâ†{ğ•Š: aâˆ¾â†©j}_fastone 4 â‹„ !(    n +â‰ ğ•©)â‰¡â‰ a â‹„ !aâ‰¡vÂ¨a}_tvar 1e6   â¥Š<ğ•©}Â¨ âŸ¨1, 1â€¿2, 'a'âŸ©
%USE fastone â‹„ %USE tvar â‹„ LVâ†©"f"âŠ¸LV â‹„ {ğ•Šv: jâ†10â¥Š<v    â‹„ {aâ†ğ•© â‹„ nâ†{ğ•Š: aâˆ¾â†©j}_fastone 4 â‹„ !((10Ã—n)+â‰ ğ•©)â‰¡â‰ a â‹„ !aâ‰¡vÂ¨a}_tvar 1e6   â¥Š<ğ•©}Â¨ âŸ¨1, 1â€¿2, 'a'âŸ©
%USE fastone â‹„ %USE tvar â‹„ LVâ†©"f"âŠ¸LV â‹„ {ğ•Šv: jâ†10â¥Š<v    â‹„ {aâ†ğ•© â‹„ nâ†{ğ•Š: aâˆ¾â†©j}_fastone 4 â‹„ !(10â‹ˆËœ n+â‰ ğ•©)â‰¡â‰¢a â‹„ !aâ‰¡vÂ¨a}_tvar 1e5â€¿10â¥Š<ğ•©}Â¨ âŸ¨1, 1â€¿2, 'a'âŸ©

# amortized fast â‹ with long ğ•¨ & tiny ğ•©
%USE fastone â‹„ %USE tvar â‹„ LVâ†©"f"âŠ¸LV â‹„ (1e6/â†•10) {ğ•¨âŠ¸â‹âŸœğ•© _fastone 1} _tvar â†•10
