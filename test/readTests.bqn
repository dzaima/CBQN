#! /usr/bin/env dbqn
"Usage: ./test.bqn path/to/mlochbaum/BQN [-qsmevw] name | ./BQN"!2â‰¤â‰ â€¢args
# q - no "finished" at end
# s - only non-erroring
# e - only erroring
# v - verify that the result is the expected one
# w - wrap each expression in {}s so it can be a single compilation unit
pathâ†â€¢wdpathâ€¢file.At âŠ‘â€¢args
argsâ†1â†“â€¢args
optâ†""
{ğ•Š: optâ†©ğ•© â‹„ argsâ†“Ëœâ†©1}âŸ('-'â‰¡âŠ‘) âŠ‘args
verify  â† âŠ‘'v'âˆŠopt
wrap    â† âŠ‘'w'âˆŠopt
onlyErr â† âŠ‘'e'âˆŠopt
onlyReg â† âŠ‘'s'âˆŠopt

"Missing argument!"!0<â‰ args
{
  case â† ğ•©âˆ¾".bqn"
  tests â† â€¢FLines pathâˆ¾"/test/cases/"âˆ¾case
  tests/Ëœâ†© (("#"â‰¢1âŠ¸â†‘)âˆ§0<â‰ )Â¨tests
  {ğ•Š: tests/Ëœâ†©'!'â‰ âŠ‘Â¨tests}âŸâŠ¢ onlyReg
  {ğ•Š: tests/Ëœâ†©'!'=âŠ‘Â¨tests}âŸâŠ¢ onlyErr
  RMC â† âŠâŸœ'#'âŠ‘âŠ¸â†‘âŠ¢ # doesn't work for token.bqn but whatever
  Q â† {
    iâ†âŠ‘ğ•©âŠ'%'
    ((1+'!'â‰ âŠ‘ğ•©)Ã—verify)â—¶âŸ¨(1+i)âŠ¸â†“ â‹„ {âˆ¾ âŸ¨"""should've errored!""âˆ˜â€¢BQNâŠ1 """ â‹„ {ğ•©/Ëœ1+ğ•©='"'}ğ•©â†“Ëœ1+âŠ‘ğ•©âŠ'%' â‹„ """"âŸ©} â‹„ {âˆ¾âŸ¨"""incorrect!""â€¿1âŠ‘Ëœ(" â‹„ iâ†‘ğ•© â‹„ ") â‰¡ {" â‹„ (1+i)â†“ğ•© â‹„ " }"âŸ©}âŸ© RMC ğ•©
  }
  Out â† {â€¢Out(âŠ‘'%'âŠ¸âˆŠ)â—¶âŸ¨{âˆ¾âŸ¨"""incorrect!""â€¿1âŠ‘Ëœ1â‰¡{"â‹„RMCğ•©â‹„" }"âŸ©}âŸverify {âˆ¾âŸ¨"{"â‹„RMCğ•©â‹„"}"âŸ©}âŸwrap â‹„ QâŸ© ğ•©}

  ((âŠ‘'m'âˆŠopt)âŠ‘Outâ€¿{â€¢Showğ•©â‹„Outğ•©})Â¨tests
  # ('%'âŠ¸âˆŠâˆ¨ '#'= Â·âŠ‘ âˆ¾âŸœ"#")â—¶â€¢Outâ€¿@Â¨tests
}Â¨args
â€¢OutâŸ(Â¬âŠ‘'q'âˆŠopt) """finished"""
â€¢OutâŸ(Â¬âŠ‘'q'âˆŠopt) ""