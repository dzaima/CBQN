fâ†@
Section â† {â€¢Out ğ•©âˆ¾Ëœ@+10}

f â†© "lib.so" â€¢FFI ""â€¿"do_nothing" â‹„ â€¢Show F âŸ¨âŸ©

Section "# ""a"""
f â†© "lib.so" â€¢FFI "i32"â€¿"getType"â€¿">a" â‹„ â€¢Show FÂ¨ âŸ¨âŸ¨âŸ©, 1, 'ğ•©', +, Â¨, âˆ˜, {â‡}âŸ©
f â†© "lib.so" â€¢FFI "a"â€¿"timesTen"â€¿"a" â‹„ â€¢Show F âŸ¨â†•10âŸ©
f â†© "lib.so" â€¢FFI "a"â€¿"readAtoms"â€¿"a"â€¿"a" â‹„ â€¢Show F âŸ¨Ã·5 â‹„ 'ğ•¨'âŸ©
f â†© "lib.so" â€¢FFI "a"â€¿"readTyped"â€¿">a" â‹„ â€¢Show F (10Ã—â†•7) + (4â¥Š<â†•10)âˆ¾3â¥Š<@+â†•10
f â†© "lib.so" â€¢FFI "a"â€¿"getShape"â€¿">a" â‹„ â€¢Show FÂ¨ {0â¥ŠËœâŒ½âŸğ•©â†•ğ•©}Â¨ â†•5
f â†© "lib.so" â€¢FFI "a"â€¿"evalBQN"â€¿">a" â‹„ â€¢Show F "â†•5"
f â†© "lib.so" â€¢FFI "a"â€¿"makeArrays" â‹„ â€¢Outâˆ˜â€¢ReprÂ¨ F âŸ¨âŸ©
f â†© "lib.so" â€¢FFI "a"â€¿"makeThree"â€¿">a" â‹„ â€¢Show F "foo"
f â†© "lib.so" â€¢FFI "i32"â€¿"directAccess"â€¿">a" â‹„ â€¢Show F "Ai32"â€¢internal.Variation â†•10
bind â† "lib.so" â€¢FFI "a"â€¿"bindAdd"â€¿">a" â‹„ g â† Bind 4 â‹„ â€¢Show G 123

Section "# namespaces"
f â†© "lib.so" â€¢FFI "a"â€¿"getField"â€¿">ğ•¨a"â€¿"a"â€¿"a" â‹„ â€¢Show {abâ‡1â€¿2 â‹„ cdâ‡3â€¿4} F âŸ¨"ab" â‹„ "default"âŸ©
f â†© "lib.so" â€¢FFI "a"â€¿"getField"â€¿">ğ•¨a"â€¿"a"â€¿"a" â‹„ â€¢Show {abâ‡1â€¿2 â‹„ cdâ‡3â€¿4} F âŸ¨"ef" â‹„ "default"âŸ©

Section "# print args"
f â†© "lib.so" â€¢FFI ""â€¿"printArgs"â€¿"i8"â€¿"i16"â€¿"i32"â€¿"u8"â€¿"u16"â€¿"u32"â€¿"f32"â€¿"f64" â‹„ â€¢Show F Â¯123â€¿Â¯12323â€¿Â¯212312312â€¿250â€¿50000â€¿3123456789â€¿Ï€âˆ¾Ã·3
f â†© "lib.so" â€¢FFI ""â€¿ "noopArgs"â€¿"i8"â€¿"i16"â€¿"i32"â€¿"u8"â€¿"u16"â€¿"u32"â€¿"f32"â€¿"f64" â‹„ â€¢Show F Â¯123â€¿Â¯12323â€¿Â¯212312312â€¿250â€¿50000â€¿3123456789â€¿Ï€âˆ¾Ã·3
f â†© "lib.so" â€¢FFI ""â€¿"printPtrArgs"â€¿"*i8"â€¿"*i16"â€¿"*i32"â€¿"*u8"â€¿"*u16"â€¿"*u32"â€¿"*f32"â€¿"*f64" â‹„ â€¢Show F â¥ŠÂ¨Â¯123â€¿Â¯12323â€¿Â¯212312312â€¿250â€¿50000â€¿3123456789â€¿Ï€âˆ¾Ã·3
f â†© "lib.so" â€¢FFI ""â€¿"printPtrArgs"â€¿"&i8"â€¿"&i16"â€¿"&i32"â€¿"&u8"â€¿"&u16"â€¿"&u32"â€¿"&f32"â€¿"&f64" â‹„ â€¢Show F â¥ŠÂ¨Â¯123â€¿Â¯12323â€¿Â¯212312312â€¿250â€¿50000â€¿3123456789â€¿Ï€âˆ¾Ã·3

f â†© "lib.so" â€¢FFI "f32"â€¿"printU64s"â€¿"u64:c8"â€¿"*u64:c8" â‹„ â€¢Show F âŸ¨"hellowor", "aaaaaaaa12345678texttext"âŸ©
f â†© "lib.so" â€¢FFI "f32"â€¿"printU64s"â€¿"u64:u1"â€¿"*u64:u1" â‹„ â€¢Show F âŸ¨64â†‘âˆ¾Ã—âˆ˜â†•Â¨â†•12, 192â†‘âˆ¾Ã—âˆ˜â†•Â¨â†•21âŸ©

! 3 â‰¡ â€¢Type "lib.so" â€¢FFI ""â€¿"printArgs"â€¿"i8"â€¿"i16:c8"â€¿"i32"â€¿"u8"â€¿"u16"â€¿"u32"â€¿"f32"â€¿"f64"
! 3 â‰¡ â€¢Type "lib.so" â€¢FFI ""â€¿"printArgs"â€¿"i8"â€¿"i16:c16"â€¿"i32"â€¿"u8"â€¿"u16"â€¿"u32"â€¿"f32"â€¿"f64"
! 3 â‰¡ â€¢Type "lib.so" â€¢FFI ""â€¿"printArgs"â€¿"i8:c8"â€¿"i16"â€¿"i32"â€¿"u8"â€¿"u16"â€¿"u32"â€¿"f32"â€¿"f64"

Section "# read pointers"
f â†© "lib.so" â€¢FFI "i32"â€¿"multiplyI32Ptrs"â€¿"*i32"â€¿"*i32"â€¿"i32" â‹„ â€¢Show F âŸ¨â†•10 â‹„ â€¢Show âŒ½â†•10 â‹„ â€¢Show 10âŸ©
f â†© "lib.so" â€¢FFI "f32"â€¿"sumF32Arr"â€¿"*f32:i32"â€¿"i32" â‹„ â€¢Show F âŸ¨1065353216â€¿1073741824â€¿1077936128â€¿1082130432â€¿1084227584â€¿1086324736â€¿1088421888â€¿1090519040â€¿1091567616â€¿1092616192,10âŸ©

Section "# mutate i32*"
f â†© "lib.so" â€¢FFI âŸ¨"","incI32s","&u32",      "i32"âŸ© â‹„ â€¢Show F âŸ¨1e8Ã—20+â†•10 â‹„ 10âŸ©
f â†© "lib.so" â€¢FFI âŸ¨"","incI32s","&i32:u1",   "i32"âŸ© â‹„ â€¢Show âŠ‘F âŸ¨1â€¿0â€¿1â€¿0â€¿1â€¿0â€¿1â€¿0â€¿0â€¿1â€¿0â€¿1â€¿0â€¿0â€¿1â€¿1â€¿0â€¿1â€¿1â€¿0â€¿0â€¿0â€¿0â€¿1â€¿0â€¿1â€¿0â€¿1â€¿0â€¿0â€¿1â€¿0â€¿0â€¿0â€¿1â€¿0â€¿0â€¿0â€¿1â€¿0â€¿0â€¿0â€¿1â€¿1â€¿1â€¿0â€¿1â€¿1â€¿1â€¿1â€¿1â€¿1â€¿0â€¿0â€¿1â€¿1â€¿0â€¿0â€¿1â€¿0â€¿0â€¿1â€¿0â€¿0, 2âŸ©
f â†© "lib.so" â€¢FFI âŸ¨"","incI32s","&i32:c8",   "i32"âŸ© â‹„ â€¢Show âŠ‘F âŸ¨"helloworld", 2âŸ©
f â†© "lib.so" â€¢FFI âŸ¨"","incI32s",">ğ•¨&i32:c8",">i32"âŸ© â‹„ â€¢Show âŠ‘ "helloworld" F 2

f â†© "lib.so" â€¢FFI âŸ¨"", "incI32s",  "&i32:c8",  "i32"âŸ© â‹„ â€¢Show âŠ‘F âŸ¨"helloworld", 2âŸ©
f â†© "lib.so" â€¢FFI âŸ¨"", "incI32s",  "&i32:c8", "ğ•¨i32"âŸ© â‹„ â€¢Show âŠ‘ âŸ¨2âŸ© F âŸ¨"helloworld"âŸ©
f â†© "lib.so" â€¢FFI âŸ¨"", "incI32s",  "&i32:c8",">ğ•¨i32"âŸ© â‹„ â€¢Show âŠ‘ 2 F âŸ¨"helloworld"âŸ©
f â†© "lib.so" â€¢FFI âŸ¨"", "incI32s", ">&i32:c8",">ğ•¨i32"âŸ© â‹„ â€¢Show âŠ‘ 2 F "helloworld"
f â†© "lib.so" â€¢FFI âŸ¨"", "incI32s",">ğ•¨&i32:c8", ">i32"âŸ© â‹„ â€¢Show âŠ‘ "helloworld" F 2
f â†© "lib.so" â€¢FFI âŸ¨"", "incI32s",  "&i32:c8",  "i32"âŸ© â‹„ â€¢Show F âŸ¨"helloworld", 2âŸ©
f â†© "lib.so" â€¢FFI âŸ¨"&","incI32s",  "&i32:c8",  "i32"âŸ© â‹„ â€¢Show F âŸ¨"helloworld", 2âŸ©

Section "# mutate i32*, i16*, i8*"
f â†© "lib.so" â€¢FFI âŸ¨"","incInts","&i32",  "&i16","&i8"âŸ© â‹„ â€¢Show F â¥ŠÂ¨ 10â€¿20â€¿30
f â†© "lib.so" â€¢FFI âŸ¨"","incInts","&i32", "ğ•¨&i16","&i8"âŸ© â‹„ â€¢Show âŸ¨â¥Š20âŸ© F â¥ŠÂ¨ 10â€¿30
f â†© "lib.so" â€¢FFI âŸ¨"","incInts","&i32",">ğ•¨&i16","&i8"âŸ© â‹„ â€¢Show âŸ¨20âŸ© F â¥ŠÂ¨ 10â€¿30

Section "# u64 tests"
f â†© "lib.so" â€¢FFI âŸ¨"u64",    "ident_u64",">u64:i32"âŸ© â‹„ â€¢Show F 1234â€¿12
f â†© "lib.so" â€¢FFI âŸ¨"u64",    "ident_u64",">u64"    âŸ© â‹„ â€¢Show F +Â´2â‹†52â€¿20
f â†© "lib.so" â€¢FFI âŸ¨"u64:i32","ident_u64",">u64"    âŸ© â‹„ â€¢Show F 123456789123456
f â†© "lib.so" â€¢FFI âŸ¨"u64:u1", "ident_u64",">u64:c8" âŸ© â‹„ â€¢Show F "hellowor"

Section "# malloc test"
f â†© "lib.so" â€¢FFI "*:i32"â€¿"malloc"â€¿">u64" â‹„ â€¢Show (â€¢internal.Typeâ‹ˆâ‰ ) malloc â† F 123
f â†© "lib.so" â€¢FFI ""â€¿"free"â€¿">*:i32" â‹„ F malloc

Section "# pick item"
f â†© "lib.so" â€¢FFI "*:i8"â€¿"pick_ptr"â€¿">**:i8"â€¿">ğ•¨i32" â‹„ â€¢Show @+0 F "helloworfoobarba"-@
f â†© "lib.so" â€¢FFI "*:c8"â€¿"pick_ptr"â€¿">**:c8"â€¿">ğ•¨i32" â‹„ â€¢Show   0 F "helloworfoobarba"
f â†© "lib.so" â€¢FFI âŸ¨"u64:i8","pick_u64",">*u64:i8",">ğ•¨i32"âŸ© â‹„ â€¢Show @+2 F "000000001234560011122100abacabad"-@
f â†© "lib.so" â€¢FFI âŸ¨"u64:i8","pick_u64",">*u64:i8",">ğ•¨i32"âŸ© â‹„ â€¢Show @+3 F "000000001234560011122100abacabad"-@
f â†© "lib.so" â€¢FFI âŸ¨"u64",   "pick_u64",">*u64:i8",">ğ•¨i32"âŸ© â‹„ â€¢Show   1 F "000000001234560011122100"-'0'

Section "# structs"
s1 â† "{u8,i32,i16,u64:u16,f64}" â‹„ s2 â† âˆ¾"{"â€¿s1â€¿","â€¿s1â€¿"}"
f â†© "lib.so" â€¢FFI âŸ¨"i16", "thirdMember", ">"âˆ¾s1âŸ© â‹„ â€¢Show F âŸ¨200, 2e9, Â¯30000, 1â€¿2â€¿3â€¿4, 3.25âŸ©
f â†© "lib.so" â€¢FFI âŸ¨s1, "incMembers", ">"âˆ¾s1âŸ© â‹„ â€¢Show F âŸ¨200, 2e9, Â¯30000, 1â€¿2â€¿3â€¿4, 3.25âŸ©
f â†© "lib.so" â€¢FFI âŸ¨"&", "incMany", "&"âˆ¾s2, "u64"âŸ© â‹„ â€¢ShowÂ¨ F âŸ¨0â€¿3â€¿6+3â¥Š<0â€¿1+2â¥Š<âŸ¨200, 2e9, Â¯30000, 1â€¿2â€¿3â€¿4, 3.25âŸ©, 3âŸ©

{
  calloc â† @â€¢FFI"*:i32"â€¿"calloc"â€¿"u64"â€¿"u64" â‹„ mem â† Calloc 3â€¿4
  f â† "lib.so" â€¢FFI "i32"â€¿"arrayRefOp"â€¿">&{*:i32,u64}"
  {ğ•Š: âŸ¨sum, âŸ¨arrâ€¿szâŸ©âŸ© â† F âŸ¨memâ€¿3âŸ© â‹„ â€¢Show sum âˆ¾ arr-mem}Â¨ â†•2
}

Section "# self-ffi"
â€¢term.Flush@
f â†© @ â€¢FFI âŸ¨"i32", "putchar", ">i32"âŸ© â‹„ FÂ¨ 10âˆ¾Ëœ"text"-@
â€¢term.Flush@
f â†© @ â€¢FFI âŸ¨"a", "bqn_makeChar", ">u64"âŸ© â‹„ â€¢Show F 120169

Section "# array types"

f â†© "lib.so"â€¢FFI"i32"â€¿"arrarg"â€¿">[3]i32" â‹„ â€¢Show F âŸ¨1,2,3âŸ©
f â†© "lib.so"â€¢FFI"i32"â€¿"ptrToArr"â€¿">*[2]i32" â‹„ â€¢Show F âŸ¨0â€¿0, 0â€¿0, 0â€¿0, 10â€¿20, 3â€¿4âŸ©

as1 â† "{[1]i32}"
f â†© "lib.so"â€¢FFI âŸ¨"i32", "arrstruct1", as1, "*"âˆ¾as1âŸ© â‹„ â€¢Show F âŸ¨â‹ˆâ‹ˆ10, âŸ¨â‹ˆâ‹ˆ20âŸ©âŸ©

as2 â† "{[1]i32,[2]"âˆ¾as1âˆ¾",[3]f64}"
f â†© "lib.so"â€¢FFI âŸ¨as2, "arrstruct2", as2, "*"âˆ¾as2âŸ© â‹„ â€¢Out â€¢Repr F âŸ¨âŸ¨âŸ¨4âŸ© â‹„ â‹ˆâˆ˜â‹ˆÂ¨1â€¿2 â‹„ 1.2â€¿2.3â€¿3.4âŸ©, âŸ¨âŸ¨âŸ¨5âŸ© â‹„ â‹ˆâˆ˜â‹ˆÂ¨10â€¿20 â‹„ 5.1â€¿6.1â€¿7.1âŸ©âŸ©âŸ©
f â†© "lib.so"â€¢FFI âŸ¨"&", "arrstruct2Inc", ">&"âˆ¾as2âŸ© â‹„ â€¢Out â€¢Repr F (âŠ¢â‹ˆ50âŠ¸+) âŸ¨âŸ¨10âŸ© â‹„ â‹ˆâˆ˜â‹ˆÂ¨11â€¿12 â‹„ 13â€¿14â€¿15âŸ©

# erroring:

# "lib.so" â€¢FFI ""â€¿"printArgs"â€¿"i8"â€¿"i16:c32"â€¿"i32"â€¿"u8"â€¿"u16"â€¿"u32"â€¿"f32"â€¿"f64"
# "lib.so" â€¢FFI ""â€¿"testArgs"â€¿"i8:c16"â€¿"i16"â€¿"i32"â€¿"u8"â€¿"u16"â€¿"u32"â€¿"f32"â€¿"f64"
# "lib.so" â€¢FFI ""â€¿"testArgs"â€¿"i8:c32"â€¿"i16"â€¿"i32"â€¿"u8"â€¿"u16"â€¿"u32"â€¿"f32"â€¿"f64"

# f â†© "lib.so" â€¢FFI "u64"â€¿"ident_u64"â€¿">u64:i32" â‹„ â€¢Show F 1234â€¿12344444
# f â†© "lib.so" â€¢FFI "u64"â€¿"ident_u64"â€¿">u64" â‹„ â€¢Show F +Â´2â‹†53â€¿20

# f â†© "lib.so"â€¢FFI"i32"â€¿"arrarg"â€¿">[3]i32" â‹„ â€¢Show F âŸ¨1,2âŸ©
# f â†© "lib.so"â€¢FFI âŸ¨as2, "arrstruct2", as2, "*"âˆ¾as2âŸ© â‹„ â€¢Show F âŸ¨âŸ¨âŸ¨4âŸ© â‹„ â‹ˆâˆ˜â‹ˆÂ¨1â€¿2 â‹„ 1.2â€¿2.3â€¿3.4â€¿4âŸ©, âŸ¨âŸ¨âŸ¨5âŸ© â‹„ â‹ˆâˆ˜â‹ˆÂ¨10â€¿20 â‹„ 5.1â€¿6.1â€¿7.1âŸ©âŸ©âŸ©
# f â†© "lib.so"â€¢FFI âŸ¨as2, "arrstruct2", as2, "*"âˆ¾as2âŸ© â‹„ â€¢Show F âŸ¨âŸ¨âŸ¨4âŸ© â‹„ â‹ˆâˆ˜â‹ˆÂ¨1â€¿2 â‹„ 1.2â€¿2.3â€¿3.4âŸ©, âŸ¨âŸ¨âŸ¨5âŸ© â‹„ â‹ˆâˆ˜â‹ˆÂ¨10â€¿20 â‹„ 5.1â€¿6.1â€¿7.1â€¿5âŸ©âŸ©âŸ©
# f â†© "lib.so"â€¢FFI âŸ¨as2, "arrstruct2", as2, "*"âˆ¾as2âŸ© â‹„ â€¢Show F âŸ¨âŸ¨âŸ¨4âŸ© â‹„ â‹ˆâˆ˜â‹ˆÂ¨1â€¿2 â‹„ 1.2â€¿2.3â€¿3.4âŸ©, âŸ¨âŸ¨âŸ¨5âŸ© â‹„ â‹ˆâˆ˜â‹ˆÂ¨10â€¿20 â‹„ 5.1â€¿6.1â€¿7.1,5âŸ©âŸ©âŸ©