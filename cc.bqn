#! /usr/bin/env dbqn
argsâ†â€¢args
return â† 1â‰¡âŠ‘args
argsâ†“Ëœâ†© return
"call with argument specifying path of mlochbaum/BQN!"!2â‰¤â‰ args
pathâ†(âŠ‘args)âˆ¾"/src/"
argsâ†“Ëœâ†©1
L  â† {"m_caB("  âˆ¾(â•â‰ ğ•©)âˆ¾",(B[]){"  âˆ¾(1â†“âˆ¾","âŠ¸âˆ¾Â¨ğ•©)âˆ¾"})"}
LI â† {"m_cai32("âˆ¾(â•â‰ ğ•©)âˆ¾",(i32[]){"âˆ¾(1â†“âˆ¾","âŠ¸âˆ¾Â¨ğ•©)âˆ¾"})"}
# Escape the special characters that appear in BQN sources.
Escâ†{
  in â† (@+0â€¿9â€¿10â€¿13)âˆ¾"'"""    # Null, Tab, LF, CR, and quotes
  out â† "0tnr"                # Whitespace characters changed to letters
  i â† inâŠğ•©
  ğ•© â†© i âŠâŸœoutâŒ¾((i<â‰ out)âŠ¸/) ğ•©  # Replace
  âˆ¾(i<â‰ in) /âŸœ"\"âŠ¸âˆ¾Â¨ ğ•©         # Insert \
}
Str â† "m_str32(U"""âˆ¾Escâˆ¾""")"Ëœ     # A BQN string
Char â† {"m_c32(U'"âˆ¾(Escâ¥Šğ•©)âˆ¾"')"}          # A BQN character
Num â† {sâ†"-"/Ëœğ•©<0 â‹„ âˆâŠ¸=âˆ˜|â—¶âŸ¨"m_f64("âˆ¾")"âˆ¾Ëœsâˆ¾â•âˆ˜| â‹„ "m_f64("âˆ¾sâˆ¾"1.0/0.0)"âŸ©ğ•©} # Format number

F â† â•  # Format number

Import â† â€¢Import pathâŠ¸âˆ¾
FChars â† â€¢FChars pathâŠ¸âˆ¾

compile â† Import "c.bqn"
useInd â† "-i"â‰¡âŠ‘args â‹„ argsâ†“Ëœâ†©useInd
Comp â† (3+useInd) â†‘ ((<"inci(runtime["âˆ¾â•âˆ¾"])"Ë™)Â¨â†•62)âŠ¸Compile
J â† âˆ¾âˆ¾âŸœ\nÂ¨
Fconst â† â‰¡â—¶âŸ¨@âŠ¸â‰¤â—¶Numâ€¿Char, Str, âŠ‘âŸ©
prov â† {"inci("âˆ¾ğ•©âˆ¾")"}Â¨"bi_type"â€¿"bi_fill"â€¿"bi_log"â€¿"bi_grLen"â€¿"bi_grOrd"â€¿"bi_asrt"â€¿"bi_add"â€¿"bi_sub"â€¿"bi_mul"â€¿"bi_div"â€¿"bi_pow"â€¿"bi_floor"â€¿"bi_eq"â€¿"bi_le"â€¿"bi_fne"â€¿"bi_shape"â€¿"bi_pick"â€¿"bi_ud"â€¿"bi_tbl"â€¿"bi_scan"â€¿"bi_fillBy"â€¿"bi_val"
Fout â† {((â‰ ğ•©)â†‘âŸ¨LI FÂ¨,L Â·provâŠ¸âˆ¾âŸ(ğ•¨âŠ£0) FconstÂ¨,L (LI FÂ¨)Â¨,L (L FÂ¨)Â¨âŸ©) {ğ•ğ•©}Â¨ ğ•©}
Frun â† 1âŠ¸Fout
Long â† {Â¯2â†“âˆ¾ğ•©âˆ¾Â¨<","âˆ¾\n}
â€¢OutâŸ(Â¬return) (âŠ‘"r"â€¿"c"â€¿"f"â€¿"e"âŠâŠ)â—¶âŸ¨
  {ğ•©â‹„refâ€¿lenâ†Import "pr.bqn"â‹„Long Frun lenâŠ¸â†“âŒ¾(1âŠ¸âŠ‘)Comp ref}
  {ğ•©â‹„Long Fout Comp FChars "c.bqn"}
  {ğ•©â‹„Long Fout Comp FChars "f.bqn"}
  {ğ•©â‹„Long Fout Comp âŸ¨"Modifyâ†GetHighlightsâ†âŠ¢â‹„"âŸ©âˆ¾âˆ¾ (FChars âŠ¢)âˆ˜âˆ¾âŸœ".bqn"Â¨ "../svg"â€¿"e"}
  Â¯1 â†“ Â· J Lâˆ˜Foutâˆ˜CompÂ¨
âŸ© args
